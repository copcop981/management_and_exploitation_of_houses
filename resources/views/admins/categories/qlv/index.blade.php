@extends('admins.layouts.master')

@section('title')
    Danh sách quản lý viên
@endsection

@section('style')
    <style>
        fieldset.scheduler-border {
            border: 1px groove #ddd !important;
            padding: 0 1.4em .2em 1.4em !important;
            margin: 0 !important;
            -webkit-box-shadow: 0px 0px 0px 0px #000;
                    box-shadow: 0px 0px 0px 0px #000;
        }

        legend.scheduler-border {
            /* font-size: 1.2em !important; */
            /* font-weight: bold !important; */
            /* text-align: left !important; */
            width: auto;
            padding: 0 10px;
            border-bottom: none;
        }

        .list_apartment_name {
            display: block;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            text-overflow: ellipsis;
        }
    </style>
@endsection

@section('content')
<!--# Page header -->
<div class="page-header page-header-light">
    <div class="page-header-content header-elements-lg-inline">
        <div class="page-title d-flex"></div>
        <div class="header-elements d-none">
            <div class="d-flex justify-content-center">
                <a href="#" class="btn btn-link btn-float text-body"><i class="icon-bars-alt text-primary"></i><span>Thống kê</span></a>
                <a href="#" class="btn btn-link btn-float text-body"><i class="icon-calculator text-primary"></i> <span>Hóa đơn</span></a>
                <a href="#" class="btn btn-link btn-float text-body"><i class="icon-calendar5 text-primary"></i> <span>Lịch trình</span></a>
            </div>
        </div>
    </div>
    <div class="breadcrumb-line breadcrumb-line-light header-elements-lg-inline">
        <div class="d-flex">
            <div class="breadcrumb">
                <a href="index.html" class="breadcrumb-item"><i class="icon-home2 mr-2"></i> Trang chủ</a>
                <a href="alpaca_advanced.html" class="breadcrumb-item">Danh sách quản lý viên</a>
                <!-- <span class="breadcrumb-item active">Trang 1</span> -->
            </div>
            <a href="#" class="header-elements-toggle text-body d-lg-none"><i class="icon-more"></i></a>
        </div>
    </div>
</div>
<!--# /page header -->

<div class="content">
    <div class="card mb-4">
        <div class="container mb-2">
            <div class="mt-2">
                <fieldset class="scheduler-border">
                    <legend class="scheduler-border">Tìm kiếm</legend>
                    <form action="" method="" id="form_search">
                        <div class="row">
                            <div class="col-6">
                                <div class="form-group">
                                    <div class="row align-items-center">
                                        <div class="col-4">
                                            <label for="qlv" class="float-right col-form-label">Tên quản lý viên</label>
                                        </div>
                                        <div class="col-8">
                                            <input list="list_qlv" name="qlv" id="qlv" class="form-control form-control-sm">
                                            <datalist id="list_qlv">
                                            </datalist>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="form-group">
                                    <div class="row align-items-center">
                                        <div class="col-4">
                                            <label for="apartment" class="float-right col-form-label">Tên chung cư</label>
                                        </div>
                                        <div class="col-8">
                                            <input list="list_apartment" name="apartment" id="apartment" class="form-control form-control-sm">
                                            <datalist id="list_apartment">
                                            </datalist>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {{-- <div class="row">
                            <div class="col-6">
                                <div class="form-group">
                                    <div class="row align-items-center">
                                        <div class="col-4">
                                            <label for="qlv_apartment" class="float-right col-form-label">Tên chung cư</label>
                                        </div>
                                        <div class="col-8">
                                            <input list="qlv_apartments" name="qlv_apartment" id="qlv_apartment" class="form-control form-control-sm">
                                            <datalist id="qlv_apartments">
                                            </datalist>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="form-group">
                                    <div class="row align-items-center">
                                        <div class="col-4">
                                            <label for="qlv_block" class="float-right col-form-label">Nhà</label>
                                        </div>
                                        <div class="col-8">
                                            <input list="qlv_blocks" name="qlv_block" id="qlv_block" class="form-control form-control-sm">
                                            <datalist id="qlv_blocks">
                                            </datalist>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div> --}}
                        <div class="row">
                            <div class="col-6">
                                {{-- <div class="form-group">
                                    <div class="row align-items-center">
                                        <div class="col-4">
                                            <label for="" class="float-right">Tên chung cư</label>
                                        </div>
                                        <div class="col-8">
                                            <select name="" id="" class="form-control form-control-sm">
                                                <option value="0">--- Chọn chung cư ---</option>
                                            </select>
                                        </div>
                                    </div>
                                </div> --}}
                            </div>
                            <div class="col-6">
                                <div class="form-group">
                                    <div class="row align-items-center">
                                        <div class="col-4">
                                            
                                        </div>
                                        <div class="col-8">
                                            <button type="button" class="btn btn-success btn-sm" id="search_qlv_btn">
                                                <i class="fa-solid fa-magnifying-glass mr-1"></i>
                                                Tìm kiếm
                                            </button>
                                            <button type="button" class="btn btn-warning btn-sm" id="refresh_input_search_btn">
                                                <i class="fa-solid fa-rotate mr-1"></i>
                                                Làm mới
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </fieldset>
            </div>

            <div class="mt-3">
                <div class="d-flex justify-content-between">
                    <div>
                        <select name="" id="row" class="form-control custom-select">
                            <option value="5">5 hàng</option>
                            <option value="10">10 hàng</option>
                            <option value="15">15 hàng</option>
                            <option value="20">20 hàng</option>
                        </select>
                    </div>
                    <div>
                        <button type="button" class="btn btn-info btn-sm" id="create_qlv_btn">
                            <i class="fa-solid fa-plus mr-1"></i>
                            Tạo mới
                        </button>
                        {{-- <button type="button" class="btn btn-success btn-sm" id="edit_qlv_btn">
                            <i class="fa-solid fa-pen mr-1"></i>
                            Chỉnh sửa
                        </button> --}}
                        <button type="button" class="btn btn-danger btn-sm" id="delete_many_qlv_btn" hidden>
                            <i class="fa-solid fa-trash mr-1"></i>
                            Xóa hàng loạt
                        </button>
                    </div>
                </div>
            </div>

            <div class="mt-3">
                <i class="fa-solid fa-paper-plane" style="color: #868686;"></i>
                <span class="text-uppercase" style="color: #868686; font-weight: 500;">Danh sách quản lý viên</span>
            </div>

            <div id="list_qlv_table">
                @include('admins.categories.qlv.pagination')
            </div>

            {{-- Modal Tạo mới --}}
            <div class="modal fade" id="modal_create_qlv" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel">Tạo mới</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <form action="" id="form_create_qlv">
                                <div class="row">
                                    <div class="col-3">
                                        <label for="qlv_fullname_create" class="col-form-label float-right">Tên quản lý viên</label>
                                    </div>
                                    <div class="col-9">
                                        <input type="text" name="" id="qlv_fullname_create" class="form-control form-control-sm">
                                    </div>
                                </div>
                                <div class="row mt-2">
                                    <div class="col-3">
                                        <label for="qlv_phone_number_create" class="col-form-label float-right">Số điện thoại</label>
                                    </div>
                                    <div class="col-9">
                                        <input type="number" name="" id="qlv_phone_number_create" class="form-control form-control-sm">
                                    </div>
                                </div>
                                <div class="row mt-2">
                                    <div class="col-3">
                                        <label for="list_apartment_create" class="col-form-label float-right">Tên chung cư</label>
                                    </div>
                                    <div class="col-9">
                                        <select name="" class="form-control form-control-sm" id="list_apartment_create" multiple>
                                        </select>
                                    </div>
                                    {{-- <div class="col-1 p-0">
                                        <button type="button" class="btn btn-outline-info btn-sm">
                                            <i class="fa-solid fa-plus"></i>
                                        </button>
                                    </div> --}}
                                </div>  
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-outline-secondary btn-sm" data-dismiss="modal">Đóng</button>
                            <button type="button" class="btn btn-warning btn-sm" id="refresh_save_qlv_btn" style="margin-left: 0.5rem !important;">Làm mới</button>
                            <button type="button" class="btn btn-primary btn-sm" id="save_qlv_btn" style="margin-left: 0.5rem !important;">Lưu</button>
                        </div>
                    </div>
                </div>
            </div>

            {{-- Modal Chỉnh sửa --}}
            <div class="modal fade" id="modal_edit_qlv" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel">Chỉnh sửa</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <form action="" id="form_edit_qlv">
                                <input type="hidden" name="" id="qlv_id_edit" value="">
                                <div class="row">
                                    <div class="col-3">
                                        <label for="qlv_fullname_edit" class="col-form-label float-right">Tên quản lý viên</label>
                                    </div>
                                    <div class="col-9">
                                        <input type="text" name="" id="qlv_fullname_edit" class="form-control form-control-sm">
                                    </div>
                                </div>
                                <div class="row mt-2">
                                    <div class="col-3">
                                        <label for="qlv_phone_number_edit" class="col-form-label float-right">Số điện thoại</label>
                                    </div>
                                    <div class="col-9">
                                        <input type="number" name="" id="qlv_phone_number_edit" class="form-control form-control-sm">
                                    </div>
                                </div>
                                <div class="row mt-2">
                                    <div class="col-3">
                                        <label for="list_apartment_edit" class="col-form-label float-right">Tên chung cư</label>
                                    </div>
                                    <div class="col-9">
                                        <select name="" class="form-control form-control-sm" id="list_apartment_edit" multiple>
                                        </select>
                                    </div>
                                    {{-- <div class="col-1 p-0">
                                        <button type="button" class="btn btn-outline-info btn-sm">
                                            <i class="fa-solid fa-plus"></i>
                                        </button>
                                    </div> --}}
                                </div>  
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-outline-secondary btn-sm" data-dismiss="modal">Đóng</button>
                            <button type="button" class="btn btn-warning btn-sm" id="refresh_update_qlv_btn" style="margin-left: 0.5rem !important;">Làm mới</button>
                            <button type="button" class="btn btn-success btn-sm" id="update_qlv_btn" style="margin-left: 0.5rem !important;">Cập nhật</button>
                        </div>
                    </div>
                </div>
            </div>

            {{-- Modal Xóa --}}
            <div class="modal fade" id="modal_delete_qlv" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel">Xác nhận</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <input type="hidden" id="qlv_id_delete" value="">
                            <span id="confirm_message"></span>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-outline-secondary btn-sm" data-dismiss="modal">Đóng</button>
                            <button type="button" class="btn btn-danger btn-sm" id="destroy_qlv_btn" style="margin-left: 0.5rem !important;">Xác nhận xóa</button>
                        </div>
                    </div>
                </div>
            </div>

            {{-- Modal Xem chi tiết --}}
            <div class="modal fade" id="modal_show_qlv" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel">Xem chi tiết</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <form action="" id="form_show_qlv">
                                <div class="row align-items-center">
                                    <div class="col-3">
                                        <label for="qlv_fullname_show" class="col-form-label float-right">Tên quản lý viên:</label>
                                    </div>
                                    <div class="col-9">
                                        {{-- <input type="text" name="" id="qlv_fullname_show" class="form-control form-control-sm"> --}}
                                        <span class="text-danger" id="qlv_fullname_show"></span>
                                    </div>
                                </div>
                                <div class="row align-items-center mt-2">
                                    <div class="col-3">
                                        <label for="qlv_phone_number_show" class="col-form-label float-right">Số điện thoại:</label>
                                    </div>
                                    <div class="col-9">
                                        {{-- <input type="number" name="qlv_phone_number_show" id="qlv_phone_number_show" class="form-control form-control-sm"> --}}
                                        <span class="text-danger" id="qlv_phone_number_show"></span>
                                    </div>
                                </div>
                                <div class="row mt-2">
                                    <div class="col-3">
                                        <label for="list_apartment_show" class="col-form-label float-right">Tên chung cư:</label>
                                    </div>
                                    <div class="col-9">
                                        <select name="" class="form-control form-control-sm" id="list_apartment_show" multiple disabled>
                                        </select>
                                    </div>
                                    {{-- <div class="col-1 p-0">
                                        <button type="button" class="btn btn-outline-info btn-sm">
                                            <i class="fa-solid fa-plus"></i>
                                        </button>
                                    </div> --}}
                                </div>  
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-outline-secondary btn-sm" data-dismiss="modal">Đóng</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
@endsection

@section('script')
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="{{ asset('./js/index.js') }}"></script>
<script>
    $(document).ready(function() {
        function validateQlv(name, phoneNumber, btn) {
            let validateFullname = validateField(name, btn, 'input', 'Vui lòng nhập tên Quản lý viên');
            let validatePhoneNumber = validateField(phoneNumber, btn, 'input', 'Vui lòng nhập Số điện thoại');
            if(!validateFullname || !validatePhoneNumber)  return false;
            return true;
        }

        $(document).on('click', '#create_qlv_btn', function(e) {
            e.preventDefault();
            $('#modal_create_qlv').modal('show');

            $(document).on('shown.bs.modal', '#modal_create_qlv', function() {
                $.ajax({
                    type: "GET",
                    url: "{{ route('get.list.apartment.to.modal') }}",
                    success: function (res) {
                        if(res.status == 200) {
                            listCbbName($('#list_apartment_create'), res.apartments);
                        }
                    }
                });
            });

            $(document).off('click', '#refresh_save_qlv_btn').on('click', '#refresh_save_qlv_btn', function(e) {
                e.preventDefault();
                $('#form_create_qlv').find(':input').val('');
                $(this).off('click');
            });

            $(document).prop('disabled', false).off('click', '#save_qlv_btn').on('click', '#save_qlv_btn', function(e) {
                e.preventDefault();
                $(this).prop('disabled', true);
                let fullname = $('#qlv_fullname_create');
                let phoneNumber = $('#qlv_phone_number_create');
                let listApartmentId = [];
                $('#list_apartment_create > option:selected').each(function() {
                    listApartmentId.push($(this).val());
                });

                if(!validateQlv('#qlv_fullname_create', '#qlv_phone_number_create', $(this))) 
                    return;
                $.ajax({
                    type: "POST",
                    url: "{{ route('qlv.store') }}",
                    data: {
                        fullname: fullname.val(),
                        phoneNumber: phoneNumber.val(),
                        listApartmentId: listApartmentId,
                        _token: "{{ csrf_token() }}",
                    },
                    success: function (res) {
                        if(res.status == 200) {
                            alert(res.message);
                            $('#modal_create_qlv').modal('hide');
                            $('#save_qlv_btn').off('click');
                            $('#save_qlv_btn').prop('disabled', false);
                            $('#refresh_input_search_btn').click();

                        }
                        if(res.status == 400) {
                            alert(res.message);
                            $('#save_qlv_btn').off('click');
                            $('#save_qlv_btn').prop('disabled', false);
                        }
                    }
                });
            });

            $('#modal_create_qlv').on('hidden.bs.modal', function() {
                $('#form_create_qlv').find(':input').val('');
                $('#form_create_qlv').find('.border.border-danger').removeClass('border border-danger');
                $('#form_create_qlv').find('.text-danger').remove();
            });
        });

        $(document).on('click', '#edit_qlv_btn', function(e) {
            e.preventDefault();
            $('#modal_edit_qlv').modal('show');
            let fullname = $('#qlv_fullname_edit');
            let phoneNumber = $('#qlv_phone_number_edit');
            let id = $(this).val();
            let url = "{{ route('qlv.edit', ':id') }}";
            url = url.replace(':id', id);
            $.ajax({
                type: "GET",
                url: url,
                success: function (res) {
                    if(res.status == 200) {
                        fullname.val(res.qlv.fullname);
                        phoneNumber.val(res.qlv.phone_number);
                        $('#qlv_id_edit').val(res.qlv.id);
                        listCbbName($('#list_apartment_edit'), res.listApartment);
                        let listApartment = $('#list_apartment_edit > option');
                        $.each(res.apartments, function(key, value) {
                            listApartment.each(function() {
                                if($(this).val() == value.id) {
                                    $(this).prop('selected', true);
                                }
                            });
                        });
                    }
                }
            });

            $(document).off('click', '#refresh_update_qlv_btn').on('click', '#refresh_update_qlv_btn', function(e) {
                e.preventDefault();
                $('#form_edit_qlv').find(':input').val('');
                $(this).off('click');
            });

            $(document).prop('disabled', false).off('click', '#update_qlv_btn').on('click', '#update_qlv_btn', function(e) {
                e.preventDefault();
                let listApartmentId = [];
                $('#list_apartment_edit > option:selected').each(function() {
                    listApartmentId.push($(this).val());
                });
                $(this).prop('disabled', true);
                if(!validateQlv('#qlv_fullname_edit', '#qlv_phone_number_edit', $(this))) 
                    return;
                url = "{{ route('qlv.update', ':id') }}";
                url = url.replace(':id', id);
                $.ajax({
                    type: "PATCH",
                    url: url,
                    data: {
                        id: id,
                        fullname: fullname.val(),
                        phoneNumber: phoneNumber.val(),
                        listApartmentId: listApartmentId,
                        _token: "{{ csrf_token() }}",
                    },
                    success: function (res) {
                        if(res.status == 200) {
                            alert(res.message);
                            $('#modal_edit_qlv').modal('hide');
                            $('#update_qlv_btn').off('click');
                            $('#update_qlv_btn').prop('disabled', false);
                            $('#refresh_input_search_btn').click();
                        }
                        if(res.status == 400 || res.status == 401) {
                            alert(res.message);
                            $('#update_qlv_btn').off('click');
                            $('#update_qlv_btn').prop('disabled', false);
                        }
                    }
                });
            });

            $('#modal_edit_qlv').on('hidden.bs.modal', function() {
                $('#form_edit_qlv').find('.border.border-danger').removeClass('border border-danger');
                $('#form_edit_qlv').find('.text-danger').remove();
                $('#list_apartment_edit > option').prop('selected', false);
            });
        });

        $(document).on('click', '#delete_qlv_btn', function(e) {
            e.preventDefault();
            $('#modal_delete_qlv').modal('show');
            $('#confirm_message').text('Chắc chắn muốn xóa Quản lý viên này?');
            let id = $(this).val();
            $('#qlv_id_delete').val(id);
            let url = "{{ route('qlv.destroy', ':id') }}";
            url = url.replace(':id', id);

            $(document).prop('disabled', false).off('click', '#destroy_qlv_btn').on('click', '#destroy_qlv_btn', function(e) {
                e.preventDefault();
                $(this).prop('disabled',  true);
                $.ajax({
                    type: "DELETE",
                    url: url,
                    data: {
                        _token: "{{ csrf_token() }}",
                    },
                    success: function (res) {
                        if(res.status == 200) {
                            alert(res.message);
                            $('#modal_delete_qlv').modal('hide');
                            $('#destroy_qlv_btn').off('click');
                            $('#destroy_qlv_btn').prop('disabled', false);
                            $('#refresh_input_search_btn').click();
                        }
                        if(res.status == 400) {
                            alert(res.message);
                            $('#destroy_qlv_btn').off('click');
                            $('#destroy_qlv_btn').prop('disabled', false);
                        }
                    }
                });
            });
        });

        $(document).on('change', '#check_all', function() {
            let isChecked = $(this).prop('checked');
            $('.check_box').prop('checked', isChecked);
            countCheckedNumber()
        });

        $(document).on('change', '.check_box', function() {
            let checkBoxItemNumber = $('.check_box').length === $('input:checkbox[name="ids"]:checked').length;
            $('#check_all').prop('checked', checkBoxItemNumber);
            countCheckedNumber()
        });

        function countCheckedNumber() {
            let checkedCount = $('input:checkbox[name="ids"]:checked').length;
            if(checkedCount > 0)
                $('#delete_many_qlv_btn').prop('hidden', false);
            else
                $('#delete_many_qlv_btn').prop('hidden', true);
        }

        $(document).on('click', '#delete_many_qlv_btn', function(e) {
            e.preventDefault();
            let allIds = [];
            $('input:checkbox[name="ids"]:checked').each(function() {
                allIds.push($(this).val());
            });
            $('#modal_delete_qlv').modal('show');
            $('#confirm_message').text('Chắc chắn muốn xóa những Quản lý viên này?');

            $(document).prop('disabled', false).off('click', '#destroy_qlv_btn').on('click', '#destroy_qlv_btn', function(e) {
                e.preventDefault();
                $(this).prop('disabled', true);
                $.ajax({
                    type: "DELETE",
                    url: "{{ route('qlv.delete.many') }}",
                    data: {
                        allIds: allIds,
                        _token: '{{ csrf_token() }}',
                    },
                    success: function (res) {
                        if(res.status == 200) {
                            alert(res.message);
                            $('#modal_delete_qlv').modal('hide');
                            $('#destroy_qlv_btn').off('click');
                            $('#destroy_qlv_btn').prop('disabled', false);
                            $('#refresh_input_search_btn').click();
                        } else if(res.status == 400) {
                            alert(res.message);
                            $('#destroy_qlv_btn').off('click');
                            $('#destroy_qlv_btn').prop('disabled', false);
                        }
                    }
                });
            });
        });

        $(document).on('click', '.pagination a', function(e) {
            e.preventDefault();
            let page = $(this).attr('href').split('?page=')[1];
            let numRow = $('#row').val();
            $.ajax({
                url: "/admins/categories/qlv/fetch?page=" + page,
                data: {
                    numRow: numRow > 0 ? numRow : 0,
                },
                success: function (res) {
                    $('#list_qlv_table').html(res);
                    $('#row').val(numRow);
                }
            });
        });

        $(document).on('change', '#row', function() {
            let numRow = $(this).val();
            $.ajax({
                url: "{{ route('get.row.qlv') }}",
                data: {
                    numRow: numRow,
                },
                success: function (res) {
                    $('#list_qlv_table').html(res);
                    $('#row').val(numRow);
                }
            });
        });

        $(document).prop('disabled', false).off('click', '#refresh_input_search_btn').on('click', '#refresh_input_search_btn', function(e) {
            e.preventDefault();
            $(this).prop('disabled', true);
            $('#form_search').find(':input').val('');
            $('#delete_many_qlv_btn').prop('hidden', true);
            $('#row').val('5').change();
            if($('#links').hasClass('d-none')) 
                $('#links').removeClass('d-none');
            if($('#row').hasClass('d-none')) 
                $('#row').removeClass('d-none');
            $.ajax({
                type: "GET",
                url: "{{ route('get.list.qlv') }}",
                success: function (res) {
                    if(res.status == 200) {
                        listDatalistFullname($('#list_qlv'), res.qlvs);
                    }
                }
            });
            $.ajax({
                type: "GET",
                url: "{{ route('get.list.apartment') }}",
                success: function (res) {
                    if(res.status == 200) {
                        listDatalistName($('#list_apartment'), res.apartments);
                    }
                }
            });
            $(this).prop('disabled', false);
        });
        $('#refresh_input_search_btn').click();

        $(document).prop('disabled', false).off('click', '#search_qlv_btn').on('click', '#search_qlv_btn', function(e) {
            e.preventDefault();
            $(this).prop('disabled', true);
            let qlvName = $('input[name="qlv"]').val();
            let apartmentName = $('input[name="apartment"]').val();
            $.ajax({
                type: "GET",
                url: "{{ route('qlv.search') }}",
                data: {
                    qlvName: qlvName,
                    apartmentName: apartmentName,
                },
                success: function (res) {
                    $('#list_qlv_table').html(res);
                    // $('#links').addClass('d-none');
                    // $('#row').addClass('d-none');
                    $('#row').val('15');
                    $('#search_qlv_btn').prop('disabled', false);
                }
            });
        });

        $(document).off('click', '#show_qlv_btn').on('click', '#show_qlv_btn', function(e) {
            e.preventDefault();
            $('#modal_show_qlv').modal('show');
            let qlvName = $('#qlv_fullname_show');
            let qlvPhoneNumber = $('#qlv_phone_number_show');
            let qlvId = $(this).val();
            let url = "{{ route('qlv.show', ':id') }}";
            url = url.replace(':id', qlvId);
            $.ajax({
                type: "GET",
                url: url,
                success: function (res) {
                    if(res.status == 200) {
                        qlvName.text(res.qlv.fullname);
                        qlvPhoneNumber.text(res.qlv.phone_number);
                        listCbbName($('#list_apartment_show'), res.listApartmentOfQlv);
                    }
                }
            });
        });
    });
</script>
@endsection