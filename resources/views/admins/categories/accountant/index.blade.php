@extends('admins.layouts.master')

@section('title')
    Danh sách kế toán
@endsection

@section('style')
    <style>
        fieldset.scheduler-border {
            border: 1px groove #ddd !important;
            padding: 0 1.4em .2em 1.4em !important;
            margin: 0 !important;
            -webkit-box-shadow: 0px 0px 0px 0px #000;
                    box-shadow: 0px 0px 0px 0px #000;
        }

        legend.scheduler-border {
            /* font-size: 1.2em !important; */
            /* font-weight: bold !important; */
            /* text-align: left !important; */
            width: auto;
            padding: 0 10px;
            border-bottom: none;
        }

        .list_qlv_fullname {
            display: block;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        table {
            min-width: max-content;
        }


        th {
            box-shadow: 0 2px 2px -1px rgba(0, 0, 0, 0.4);
            background: #333;
            position: sticky;
            top: 0;
            z-index: 999;
        }

        .table-wrapper {
            max-height: 450px;
            overflow: scroll;
        }
    </style>
@endsection

@section('content')
<!--# Page header -->
<div class="page-header page-header-light">
    <div class="page-header-content header-elements-lg-inline">
        <div class="page-title d-flex"></div>
        <div class="header-elements d-none">
            <div class="d-flex justify-content-center">
                <a href="#" class="btn btn-link btn-float text-body"><i class="icon-bars-alt text-primary"></i><span>Thống kê</span></a>
                <a href="#" class="btn btn-link btn-float text-body"><i class="icon-calculator text-primary"></i> <span>Hóa đơn</span></a>
                <a href="#" class="btn btn-link btn-float text-body"><i class="icon-calendar5 text-primary"></i> <span>Lịch trình</span></a>
            </div>
        </div>
    </div>
    <div class="breadcrumb-line breadcrumb-line-light header-elements-lg-inline">
        <div class="d-flex">
            <div class="breadcrumb">
                <a href="index.html" class="breadcrumb-item"><i class="icon-home2 mr-2"></i> Trang chủ</a>
                <a href="alpaca_advanced.html" class="breadcrumb-item">Danh sách kế toán</a>
                <!-- <span class="breadcrumb-item active">Trang 1</span> -->
            </div>
            <a href="#" class="header-elements-toggle text-body d-lg-none"><i class="icon-more"></i></a>
        </div>
    </div>
</div>
<!--# /page header -->

<div class="content">
    <div class="card mb-4">
        <div class="container mb-2">
            <div class="mt-2">
                <fieldset class="scheduler-border">
                    <legend class="scheduler-border">Tìm kiếm</legend>
                    <form action="" method="" id="form_search">
                        <div class="row">
                            <div class="col-6">
                                <div class="form-group">
                                    <div class="row align-items-center">
                                        <div class="col-4">
                                            <label for="accountant" class="float-right col-form-label">Tên kế toán</label>
                                        </div>
                                        <div class="col-8">
                                            <input list="list_accountant" name="accountant" id="accountant" class="form-control form-control-sm">
                                            <datalist id="list_accountant">
                                            </datalist>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="form-group">
                                    <div class="row align-items-center">
                                        <div class="col-4">
                                            <label for="qlv" class="float-right col-form-label">Tên quản lý viên</label>
                                        </div>
                                        <div class="col-8">
                                            <input list="list_qlv" name="qlv" id="qlv" class="form-control form-control-sm">
                                            <datalist id="list_qlv">
                                            </datalist>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-6">
                                {{-- <div class="form-group">
                                    <div class="row align-items-center">
                                        <div class="col-4">
                                            <label for="" class="float-right">Tên chung cư</label>
                                        </div>
                                        <div class="col-8">
                                            <select name="" id="" class="form-control form-control-sm">
                                                <option value="0">--- Chọn chung cư ---</option>
                                            </select>
                                        </div>
                                    </div>
                                </div> --}}
                            </div>
                            <div class="col-6">
                                <div class="form-group">
                                    <div class="row align-items-center">
                                        <div class="col-4">
                                            
                                        </div>
                                        <div class="col-8">
                                            <button type="button" class="btn btn-success btn-sm" id="search_accountant_btn">
                                                <i class="fa-solid fa-magnifying-glass mr-1"></i>
                                                Tìm kiếm
                                            </button>
                                            <button type="button" class="btn btn-warning btn-sm" id="refresh_input_search_btn">
                                                <i class="fa-solid fa-rotate mr-1"></i>
                                                Làm mới
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </fieldset>
            </div>

            <div class="mt-3">
                <div class="d-flex justify-content-between">
                    <div>
                        <select name="" id="row" class="form-control custom-select">
                            <option value="5">5 hàng</option>
                            <option value="10">10 hàng</option>
                            <option value="15">15 hàng</option>
                            <option value="20">20 hàng</option>
                        </select>
                    </div>
                    <div>
                        <button type="button" class="btn btn-info btn-sm" id="create_accountant_btn">
                            <i class="fa-solid fa-plus mr-1"></i>
                            Tạo mới
                        </button>
                        {{-- <button type="button" class="btn btn-success btn-sm" data-toggle="modal" data-target="#modal_edit_accountant">
                            <i class="fa-solid fa-pen mr-1"></i>
                            Chỉnh sửa
                        </button> --}}
                        <button type="button" class="btn btn-danger btn-sm" id="delete_many_accountant_btn" hidden>
                            <i class="fa-solid fa-trash mr-1"></i>
                            Xóa hàng loạt
                        </button>
                    </div>
                </div>
            </div>

            <div class="mt-3">
                <i class="fa-solid fa-paper-plane" style="color: #868686;"></i>
                <span class="text-uppercase" style="color: #868686; font-weight: 500;">Danh sách kế toán</span>
            </div>

            <div id="list_accountant_table">
                @include('admins.categories.accountant.pagination')
            </div>

            {{-- Modal Tạo mới --}}
            <div class="modal fade" id="modal_create_accountant" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel">Tạo mới</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <form action="" id="form_create_accountant">
                                <div class="row">
                                    <div class="col-3">
                                        <label for="accountant_fullname_create" class="col-form-label float-right">Tên kế toán</label>
                                    </div>
                                    <div class="col-9">
                                        <input type="text" name="" id="accountant_fullname_create" class="form-control form-control-sm">
                                    </div>
                                </div>
                                <div class="row mt-2">
                                    <div class="col-3">
                                        <label for="accountant_phone_number_create" class="col-form-label float-right">Số điện thoại</label>
                                    </div>
                                    <div class="col-9">
                                        <input type="number" name="accountant_phone_number_create" id="accountant_phone_number_create" class="form-control form-control-sm">
                                    </div>
                                </div>
                                <div class="row mt-2">
                                    <div class="col-3">
                                        <label for="list_qlv_create" class="col-form-label float-right">Tên QLV<br>(Thuộc cấp)</label>
                                    </div>
                                    <div class="col-9">
                                        <select name="" class="form-control form-control-sm" id="list_qlv_create" multiple>
                                            {{-- @foreach ($qlvs as $qlv)
                                                <option value="{{ $qlv->id }}">{{ $qlv->fullname }}</option>
                                            @endforeach --}}
                                        </select>
                                    </div>
                                    {{-- <div class="col-1 p-0">
                                        <button type="button" class="btn btn-outline-info btn-sm">
                                            <i class="fa-solid fa-plus"></i>
                                        </button>
                                    </div> --}}
                                </div>  
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-outline-secondary btn-sm" data-dismiss="modal">Đóng</button>
                            <button type="button" class="btn btn-warning btn-sm" id="refresh_save_accountant_btn" style="margin-left: 0.5rem !important;">Làm mới</button>
                            <button type="button" class="btn btn-primary btn-sm" id="save_accountant_btn" style="margin-left: 0.5rem !important;">Lưu</button>
                        </div>
                    </div>
                </div>
            </div>

            {{-- Modal Chỉnh sửa --}}
            <div class="modal fade" id="modal_edit_accountant" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel">Chỉnh sửa</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <form action="" id="form_edit_accountant">
                                <input type="hidden" name="" id="accountant_id_edit" value="">
                                <div class="row">
                                    <div class="col-3">
                                        <label for="accountant_fullname_edit" class="col-form-label float-right">Tên kế toán</label>
                                    </div>
                                    <div class="col-9">
                                        <input type="text" name="" id="accountant_fullname_edit" class="form-control form-control-sm">
                                    </div>
                                </div>
                                <div class="row mt-2">
                                    <div class="col-3">
                                        <label for="accountant_phone_number_edit" class="col-form-label float-right">Số điện thoại</label>
                                    </div>
                                    <div class="col-9">
                                        <input type="text" name="" id="accountant_phone_number_edit" class="form-control form-control-sm">
                                    </div>
                                </div>
                                <div class="row mt-2">
                                    <div class="col-3">
                                        <label for="list_qlv_edit" class="col-form-label float-right">Tên QLV<br>(Thuộc cấp)</label>
                                    </div>
                                    <div class="col-9">
                                        <select name="" class="form-control form-control-sm" id="list_qlv_edit" multiple>
                                            {{-- @foreach ($qlvs as $qlv)
                                                <option value="{{ $qlv->id }}">{{ $qlv->fullname }}</option>
                                            @endforeach --}}
                                        </select>
                                    </div>
                                    {{-- <div class="col-1 p-0">
                                        <button type="button" class="btn btn-outline-info btn-sm">
                                            <i class="fa-solid fa-plus"></i>
                                        </button>
                                    </div> --}}
                                </div>
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-outline-secondary btn-sm" data-dismiss="modal">Đóng</button>
                            <button type="button" class="btn btn-warning btn-sm" id="refresh_update_accountant_btn" style="margin-left: 0.5rem !important;">Làm mới</button>
                            <button type="button" class="btn btn-success btn-sm" id="update_accountant_btn" style="margin-left: 0.5rem !important;">Cập nhật</button>
                        </div>
                    </div>
                </div>
            </div>

            {{-- Modal Xóa --}}
            <div class="modal fade" id="modal_delete_accountant" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel">Xác nhận</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <input type="hidden" id="accountant_id_delete" value="">
                            <span id="confirm_message"></span>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-outline-secondary btn-sm" data-dismiss="modal">Đóng</button>
                            <button type="button" class="btn btn-danger btn-sm" id="destroy_accountant_btn" style="margin-left: 0.5rem !important;">Xác nhận xóa</button>
                        </div>
                    </div>
                </div>
            </div>

            {{-- Modal Xem chi tiết --}}
            <div class="modal fade" id="modal_show_accountant" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel">Xem chi tiết</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <form action="" id="form_show_accountant">
                                <div class="row align-items-center">
                                    <div class="col-3">
                                        <label for="accountant_fullname_show" class="col-form-label float-right">Tên kế toán:</label>
                                    </div>
                                    <div class="col-9">
                                        {{-- <input type="text" name="" id="accountant_fullname_show" class="form-control form-control-sm"> --}}
                                        <span class="text-danger" id="accountant_fullname_show"></span>
                                    </div>
                                </div>
                                <div class="row align-items-center mt-2">
                                    <div class="col-3">
                                        <label for="accountant_phone_number_show" class="col-form-label float-right">Số điện thoại:</label>
                                    </div>
                                    <div class="col-9">
                                        {{-- <input type="number" name="accountant_phone_number_show" id="accountant_phone_number_show" class="form-control form-control-sm"> --}}
                                        <span class="text-danger" id="accountant_phone_number_show"></span>
                                    </div>
                                </div>
                                <div class="row mt-2">
                                    <div class="col-3">
                                        <label for="list_qlv_show" class="col-form-label float-right">Tên QLV<br>(Thuộc cấp):</label>
                                    </div>
                                    <div class="col-9">
                                        <select name="" class="form-control form-control-sm" id="list_qlv_show" multiple disabled>
                                        </select>
                                    </div>
                                    {{-- <div class="col-1 p-0">
                                        <button type="button" class="btn btn-outline-info btn-sm">
                                            <i class="fa-solid fa-plus"></i>
                                        </button>
                                    </div> --}}
                                </div>  
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-outline-secondary btn-sm" data-dismiss="modal">Đóng</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
@endsection

@section('script')
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="{{ asset('./js/index.js') }}"></script>
<script>
    $(document).ready(function() {
        function validateAccountant(name, phoneNumber, btn) {
            let validateFullname = validateField(name, btn, 'input', 'Vui lòng nhập tên Kế toán');
            let validatePhoneNumber = validateField(phoneNumber, btn, 'input', 'Vui lòng nhập Số điện thoại');
            if(!validateFullname || !validatePhoneNumber) return false;
            return true;
        }

        $(document).on('click', '#create_accountant_btn', function(e) {
            e.preventDefault();
            $('#modal_create_accountant').modal('show');

            $(document).on('shown.bs.modal', '#modal_create_accountant', function() {
                $.ajax({
                    type: "GET",
                    url: "{{ route('get.list.qlv.to.modal') }}",
                    success: function (res) {
                        if(res.status == 200) {
                            listCbbFullname($('#list_qlv_create'), res.qlvs);
                        }
                    }
                });
            });

            $(document).off('click', '#refresh_save_accountant_btn').on('click', '#refresh_save_accountant_btn', function(e) {
                e.preventDefault();
                $('#form_create_accountant').find(':input').val('');
                $(this).off('click');
            });

            $(document).prop('disabled', false).off('click', '#save_accountant_btn').on('click', '#save_accountant_btn', function(e) {
                e.preventDefault();
                $(this).prop('disabled', true);
                let fullname = $('#accountant_fullname_create');
                let phoneNumber = $('#accountant_phone_number_create');
                let listQlvId = [];
                $('#list_qlv_create > option:selected').each(function() {
                    listQlvId.push($(this).val());
                });
                
                if(!validateAccountant('#accountant_fullname_create', '#accountant_phone_number_create', $(this))) 
                    return;
                $.ajax({
                    type: "POST",
                    url: "{{ route('accountant.store') }}",
                    data: {
                        fullname: fullname.val(),
                        phoneNumber: phoneNumber.val(),
                        listQlvId: listQlvId,
                        _token: "{{ csrf_token() }}",
                    },
                    success: function (res) {
                        if(res.status == 200) {
                            alert(res.message);
                            $('#modal_create_accountant').modal('hide');
                            $('#save_accountant_btn').off('click');
                            $('#save_accountant_btn').prop('disabled', false);
                            $('#refresh_input_search_btn').click();

                        }
                        if(res.status == 400) {
                            alert(res.message);
                            $('#save_accountant_btn').off('click');
                            $('#save_accountant_btn').prop('disabled', false);
                        }
                    }
                });
            });

            $('#modal_create_accountant').on('hidden.bs.modal', function() {
                $('#form_create_accountant').find(':input').val('');
                $('#form_create_accountant').find('.border.border-danger').removeClass('border border-danger');
                $('#form_create_accountant').find('.text-danger').remove();
            });
        });

        $(document).on('click', '#edit_accountant_btn', function(e) {
            e.preventDefault();
            $('#modal_edit_accountant').modal('show');
            let fullname = $('#accountant_fullname_edit');
            let phoneNumber = $('#accountant_phone_number_edit');
            let id = $(this).val();
            let url = "{{ route('accountant.edit', ':id') }}";
            url = url.replace(':id', id);
            $.ajax({
                type: "GET",
                url: url,
                success: function (res) {
                    if(res.status == 200) {
                        fullname.val(res.accountant.fullname);
                        phoneNumber.val(res.accountant.phone_number);
                        $('#accountant_id_edit').val(res.accountant.id);
                        listCbbFullname($('#list_qlv_edit'), res.listQlv);
                        let listQlv = $('#list_qlv_edit > option');
                        $.each(res.qlvs, function(key, value) {
                            listQlv.each(function() {
                                if($(this).val() == value.id) {
                                    $(this).prop('selected', true);
                                }
                            });
                        });
                    }
                }
            });

            $(document).off('click', '#refresh_update_accountant_btn').on('click', '#refresh_update_accountant_btn', function(e) {
                e.preventDefault();
                $('#form_edit_accountant').find(':input').val('');
                $(this).off('click');
            });

            $(document).prop('disabled', false).off('click', '#update_accountant_btn').on('click', '#update_accountant_btn', function(e) {
                e.preventDefault();
                let listQlvId = [];
                $('#list_qlv_edit > option:selected').each(function() {
                    listQlvId.push($(this).val());
                });
                $(this).prop('disabled', true);

                if(!validateAccountant('#accountant_fullname_edit', '#accountant_phone_number_edit', $(this))) 
                    return;
                url = "{{ route('accountant.update', ':id') }}";
                url = url.replace(':id', id);
                $.ajax({
                    type: "PATCH",
                    url: url,
                    data: {
                        id: id,
                        fullname: fullname.val(),
                        phoneNumber: phoneNumber.val(),
                        listQlvId: listQlvId,
                        _token: "{{ csrf_token() }}",
                    },
                    success: function (res) {
                        if(res.status == 200) {
                            alert(res.message);
                            $('#modal_edit_accountant').modal('hide');
                            $('#update_accountant_btn').off('click');
                            $('#update_accountant_btn').prop('disabled', false);
                            $('#refresh_input_search_btn').click();
                        }
                        if(res.status == 400 || res.status == 401) {
                            alert(res.message);
                            $('#update_accountant_btn').off('click');
                            $('#update_accountant_btn').prop('disabled', false);
                        }
                    }
                });
            });

            $('#modal_edit_accountant').on('hidden.bs.modal', function() {
                $('#form_edit_accountant').find('.border.border-danger').removeClass('border border-danger');
                $('#form_edit_accountant').find('.text-danger').remove();
                $('#list_qlv_edit > option').prop('selected', false);
            });
        });

        $(document).on('click', '#delete_accountant_btn', function(e) {
            e.preventDefault();
            $('#modal_delete_accountant').modal('show');
            $('#confirm_message').text('Chắc chắn muốn xóa Kế toán này?');
            let id = $(this).val();
            $('#accountant_id_delete').val(id);
            let url = "{{ route('accountant.destroy', ':id') }}";
            url = url.replace(':id', id);

            $(document).prop('disabled', false).off('click', '#destroy_accountant_btn').on('click', '#destroy_accountant_btn', function(e) {
                e.preventDefault();
                $(this).prop('disabled',  true);
                $.ajax({
                    type: "DELETE",
                    url: url,
                    data: {
                        _token: "{{ csrf_token() }}",
                    },
                    success: function (res) {
                        if(res.status == 200) {
                            alert(res.message);
                            $('#modal_delete_accountant').modal('hide');
                            $('#destroy_accountant_btn').off('click');
                            $('#destroy_accountant_btn').prop('disabled', false);
                            $('#refresh_input_search_btn').click();
                        }
                        if(res.status == 400) {
                            alert(res.message);
                            $('#destroy_accountant_btn').off('click');
                            $('#destroy_accountant_btn').prop('disabled', false);
                        }
                    }
                });
            });
        });

        $(document).on('change', '#check_all', function() {
            let isChecked = $(this).prop('checked');
            $('.check_box').prop('checked', isChecked);
            countCheckedNumber()
        });

        $(document).on('change', '.check_box', function() {
            let checkBoxItemNumber = $('.check_box').length === $('input:checkbox[name="ids"]:checked').length;
            $('#check_all').prop('checked', checkBoxItemNumber);
            countCheckedNumber()
        });

        function countCheckedNumber() {
            let checkedCount = $('input:checkbox[name="ids"]:checked').length;
            if(checkedCount > 0)
                $('#delete_many_accountant_btn').prop('hidden', false);
            else
                $('#delete_many_accountant_btn').prop('hidden', true);
        }

        $(document).on('click', '#delete_many_accountant_btn', function(e) {
            e.preventDefault();
            let allIds = [];
            $('input:checkbox[name="ids"]:checked').each(function() {
                allIds.push($(this).val());
            });
            $('#modal_delete_accountant').modal('show');
            $('#confirm_message').text('Chắc chắn muốn xóa những Kế toán này?');

            $(document).prop('disabled', false).off('click', '#destroy_accountant_btn').on('click', '#destroy_accountant_btn', function(e) {
                e.preventDefault();
                $(this).prop('disabled', true);
                $.ajax({
                    type: "DELETE",
                    url: "{{ route('accountant.delete.many') }}",
                    data: {
                        allIds: allIds,
                        _token: '{{ csrf_token() }}',
                    },
                    success: function (res) {
                        if(res.status == 200) {
                            alert(res.message);
                            $('#modal_delete_accountant').modal('hide');
                            $('#destroy_accountant_btn').off('click');
                            $('#destroy_accountant_btn').prop('disabled', false);
                            $('#refresh_input_search_btn').click();
                        } else if(res.status == 400) {
                            alert(res.message);
                            $('#destroy_accountant_btn').off('click');
                            $('#destroy_accountant_btn').prop('disabled', false);
                        }
                    }
                });
            });
        });

        $(document).on('click', '.pagination a', function(e) {
            e.preventDefault();
            let page = $(this).attr('href').split('?page=')[1];
            let numRow = $('#row').val();
            $.ajax({
                url: "/admins/categories/accountant/fetch?page=" + page,
                data: {
                    numRow: numRow > 0 ? numRow : 0,
                },
                success: function (res) {
                    $('#list_accountant_table').html(res);
                    $('#row').val(numRow);
                }
            });
        });

        $(document).on('change', '#row', function() {
            let numRow = $(this).val();
            $.ajax({
                url: "{{ route('get.row.accountant') }}",
                data: {
                    numRow: numRow,
                },
                success: function (res) {
                    $('#list_accountant_table').html(res);
                    $('#row').val(numRow);
                }
            });
        });

        $(document).prop('disabled', false).off('click', '#refresh_input_search_btn').on('click', '#refresh_input_search_btn', function(e) {
            e.preventDefault();
            $(this).prop('disabled', true);
            $('#form_search').find(':input').val('');
            $('#delete_many_accountant_btn').prop('hidden', true);
            $('#row').val('5').change();
            if($('#links').hasClass('d-none')) 
                $('#links').removeClass('d-none');
            if($('#row').hasClass('d-none')) 
                $('#row').removeClass('d-none');
            $.ajax({
                type: "GET",
                url: "{{ route('get.list.accountant') }}",
                success: function (res) {
                    if(res.status == 200) {
                        listDatalistFullname($('#list_accountant'), res.accountants);
                    }
                }
            });
            $.ajax({
                type: "GET",
                url: "{{ route('get.list.qlv') }}",
                success: function (res) {
                    if(res.status == 200) {
                        listDatalistFullname($('#list_qlv'), res.qlvs);
                    }
                }
            });
            $(this).prop('disabled', false);
        });
        $('#refresh_input_search_btn').click();

        $(document).prop('disabled', false).off('click', '#search_accountant_btn').on('click', '#search_accountant_btn', function(e) {
            e.preventDefault();
            $(this).prop('disabled', true);
            let accountantName = $('input[name="accountant"]').val();
            let qlvName = $('input[name="qlv"]').val();
            $.ajax({
                type: "GET",
                url: "{{ route('accountant.search') }}",
                data: {
                    accountantName: accountantName,
                    qlvName: qlvName,
                },
                success: function (res) {
                    $('#list_accountant_table').html(res);
                    // $('#links').addClass('d-none');
                    // $('#row').addClass('d-none');
                    $('#row').val('15');
                    $('#search_accountant_btn').prop('disabled', false);
                }
            });
        });

        $(document).off('click', '#show_accountant_btn').on('click', '#show_accountant_btn', function(e) {
            e.preventDefault();
            $('#modal_show_accountant').modal('show');
            let accountantName = $('#accountant_fullname_show');
            let accountantPhoneNumber = $('#accountant_phone_number_show');
            let accountantId = $(this).val();
            let url = "{{ route('accountant.show', ':id') }}";
            url = url.replace(':id', accountantId);
            $.ajax({
                type: "GET",
                url: url,
                success: function (res) {
                    if(res.status == 200) {
                        accountantName.text(res.accountant.fullname);
                        accountantPhoneNumber.text(res.accountant.phone_number);
                        listCbbFullname($('#list_qlv_show'), res.listQlvOfAccountant);
                    }
                }
            });
        });
    });
</script>
@endsection
