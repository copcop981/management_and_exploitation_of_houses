@extends('admins.layouts.master')

@section('title')
    Danh sách chung cư
@endsection

@section('style')
<style>
    fieldset.scheduler-border {
        border: 1px groove #ddd !important;
        padding: 0 1.4em .2em 1.4em !important;
        margin: 0 !important;
        -webkit-box-shadow: 0px 0px 0px 0px #000;
                box-shadow: 0px 0px 0px 0px #000;
    }

    legend.scheduler-border {
        /* font-size: 1.2em !important; */
        /* font-weight: bold !important; */
        /* text-align: left !important; */
        width: auto;
        padding: 0 10px;
        border-bottom: none;
    }

    .list_block_name,
    .list_room_name {
        display: block;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    table {
        position: relative;
    }
    table > thead > tr {
        position: sticky;
        top: 0;
        box-shadow: 0 2px 2px -1px rgba(0, 0, 0, 0.4);
        background-color: #333333;
        z-index: 999;
    }
</style>
@endsection

@section('content')
<!--# Page header -->
<div class="page-header page-header-light">
    <div class="page-header-content header-elements-lg-inline">
        <div class="page-title d-flex"></div>
        <div class="header-elements d-none">
            <div class="d-flex justify-content-center">
                <a href="#" class="btn btn-link btn-float text-body"><i class="icon-bars-alt text-primary"></i><span>Thống kê</span></a>
                <a href="#" class="btn btn-link btn-float text-body"><i class="icon-calculator text-primary"></i> <span>Hóa đơn</span></a>
                <a href="#" class="btn btn-link btn-float text-body"><i class="icon-calendar5 text-primary"></i> <span>Lịch trình</span></a>
            </div>
        </div>
    </div>
    <div class="breadcrumb-line breadcrumb-line-light header-elements-lg-inline">
        <div class="d-flex">
            <div class="breadcrumb">
                <a href="index.html" class="breadcrumb-item"><i class="icon-home2 mr-2"></i> Trang chủ</a>
                <a href="alpaca_advanced.html" class="breadcrumb-item">Danh sách chung cư</a>
                <!-- <span class="breadcrumb-item active">Trang 1</span> -->
            </div>
            <a href="#" class="header-elements-toggle text-body d-lg-none"><i class="icon-more"></i></a>
        </div>
    </div>
</div>
<!--# /page header -->

<div class="content">
    <div class="card mb-4">
        <div class="container mb-2">
            <div class="mt-2">
                <fieldset class="scheduler-border">
                    <legend class="scheduler-border">Tìm kiếm</legend>
                    <form action="" method="" id="form_search">
                        <div class="form-group">
                            <div class="row align-items-center">
                                <div class="col-2">
                                    <label for="apartment" class="float-right col-form-label">Tên chung cư</label>
                                </div>
                                <div class="col-7">
                                    <input list="list_apartment" name="apartment" id="apartment" class="form-control form-control-sm">
                                    <datalist id="list_apartment">
                                    </datalist>
                                </div>
                                <div class="col-3">
                                    <button type="button" class="btn btn-success btn-sm" id="search_apartment_btn">
                                        <i class="fa-solid fa-magnifying-glass mr-1"></i>
                                        Tìm kiếm
                                    </button>
                                    <button type="button" class="btn btn-warning btn-sm" id="refresh_input_search_btn">
                                        <i class="fa-solid fa-rotate mr-1"></i>
                                        Làm mới
                                    </button>
                                </div>
                            </div>
                        </div>
                    </form>
                </fieldset>
            </div>

            <div class="mt-3">
                <div class="d-flex justify-content-between">
                    <div>
                        <select name="" id="row" class="form-control custom-select">
                            <option value="5">5 hàng</option>
                            <option value="10">10 hàng</option>
                            <option value="15">15 hàng</option>
                            <option value="20">20 hàng</option>
                        </select>
                    </div>
                    <div>
                        <button type="button" class="btn btn-warning btn-sm">
                            <i class="fa-solid fa-file mr-1"></i>
                            Xuất báo cáo
                        </button>
                        <button type="button" class="btn btn-info btn-sm" id="create_apartment_btn">
                            <i class="fa-solid fa-plus mr-1"></i>
                            Tạo mới
                        </button>
                        {{-- <button type="button" class="btn btn-success btn-sm" id="edit_apartment_btn">
                            <i class="fa-solid fa-pen mr-1"></i>
                            Chỉnh sửa
                        </button> --}}
                        <button type="button" class="btn btn-danger btn-sm" id="delete_many_apartment_btn" hidden>
                            <i class="fa-solid fa-trash mr-1"></i>
                            Xóa hàng loạt
                        </button>
                    </div>
                </div>
            </div>

            <div class="mt-3">
                <i class="fa-solid fa-paper-plane" style="color: #868686;"></i>
                <span class="text-uppercase" style="color: #868686; font-weight: 500;">Danh sách chung cư</span>
            </div>

            <div id="list_apartment_table">
                @include('admins.categories.apartment.pagination')
            </div>

            {{-- Modal Tạo mới Chung cư--}}
            <div class="modal fade" id="modal_create_apartment" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel">Tạo mới Chung cư</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <form action="" id="form_create_apartment">
                                <div class="row">
                                    <div class="col-3">
                                        <label for="apartment_name_create" class="col-form-label float-right">Tên chung cư</label>
                                    </div>
                                    <div class="col-9">
                                        <input type="text" name="" id="apartment_name_create" class="form-control form-control-sm">
                                    </div>
                                    {{-- <div class="col-1 p-0">
                                        <button type="button" class="btn btn-outline-info btn-sm">
                                            <i class="fa-solid fa-plus"></i>
                                        </button>
                                    </div> --}}
                                </div>
                                <div class="row mt-2">
                                    <div class="col-3">
                                        <label for="list_block_create" class="col-form-label float-right pb-0" style="line-height: 1;">Nhà</label>
                                        <br>
                                        <button type="button" class="btn btn-outline-info btn-sm float-right mt-2" id="create_block_btn">
                                            <i class="fa-solid fa-plus"></i>
                                        </button>
                                    </div>
                                    <div class="col-9">
                                        <select name="" id="list_block_create" class="form-control form-control-sm" multiple>
                                        </select>
                                    </div>
                                </div>
                                <div class="row mt-2">
                                    <div class="col-3">
                                        <label for="list_floor_create" class="col-form-label float-right pb-0" style="line-height: 1;">Tầng</label>
                                        <br>
                                        <button type="button" class="btn btn-outline-info btn-sm float-right mt-2" id="create_floor_btn">
                                            <i class="fa-solid fa-plus"></i>
                                        </button>
                                    </div>
                                    <div class="col-9">
                                        <select name="" id="list_floor_create" class="form-control form-control-sm" multiple>
                                        </select>
                                    </div>
                                </div>
                                <div class="row mt-2">
                                    <div class="col-3">
                                        <label for="list_room_create" class="col-form-label float-right pb-0" style="line-height: 1;">Căn hộ</label>
                                        <br>
                                        <button type="button" class="btn btn-outline-info btn-sm float-right mt-2" id="create_room_btn">
                                            <i class="fa-solid fa-plus"></i>
                                        </button>
                                    </div>
                                    <div class="col-9">
                                        <select name="" id="list_room_create" class="form-control form-control-sm" multiple>
                                        </select>
                                    </div>
                                </div>
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-outline-secondary btn-sm" data-dismiss="modal">Đóng</button>
                            <button type="button" class="btn btn-warning btn-sm" id="refresh_save_apartment_btn" style="margin-left: 0.5rem !important;">Làm mới</button>
                            <button type="button" class="btn btn-primary btn-sm" id="save_apartment_btn" style="margin-left: 0.5rem !important;">Lưu</button>
                        </div>
                    </div>
                </div>
            </div>

            {{-- Modal Tạo mới Block --}}
            <div class="modal fade" id="modal_create_block" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel">Tạo mới Nhà</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <form action="" id="form_create_block">
                                <div class="row">
                                    <div class="col-3">
                                        <label for="block_name_create" class="col-form-label float-right">Tên Nhà</label>
                                    </div>
                                    <div class="col-9">
                                        <input type="text" name="" id="block_name_create" class="form-control form-control-sm">
                                    </div>
                                </div>
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-outline-secondary btn-sm" data-dismiss="modal">Đóng</button>
                            <button type="button" class="btn btn-warning btn-sm" id="refresh_save_block_btn" style="margin-left: 0.5rem !important;">Làm mới</button>
                            <button type="button" class="btn btn-primary btn-sm" id="save_block_btn" style="margin-left: 0.5rem !important;">Lưu</button>
                        </div>
                    </div>
                </div>
            </div>

            {{-- Modal Tạo mới Tầng --}}
            <div class="modal fade" id="modal_create_floor" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel">Tạo mới Tầng</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <form action="" id="form_create_floor">
                                <div class="row">
                                    <div class="col-3">
                                        <label for="floor_name_create" class="col-form-label float-right">Số Tầng</label>
                                    </div>
                                    <div class="col-9">
                                        <input type="text" name="" id="floor_name_create" class="form-control form-control-sm">
                                    </div>
                                </div>
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-outline-secondary btn-sm" data-dismiss="modal">Đóng</button>
                            <button type="button" class="btn btn-warning btn-sm" id="refresh_save_floor_btn" style="margin-left: 0.5rem !important;">Làm mới</button>
                            <button type="button" class="btn btn-primary btn-sm" id="save_floor_btn" style="margin-left: 0.5rem !important;">Lưu</button>
                        </div>
                    </div>
                </div>
            </div>

            {{-- Modal Tạo mới Căn hộ --}}
            <div class="modal fade" id="modal_create_room" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel">Tạo mới Căn hộ</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <form action="" id="form_create_room">
                                <div class="row">
                                    <div class="col-3">
                                        <label for="room_name_create" class="col-form-label float-right">Tên Căn hộ</label>
                                    </div>
                                    <div class="col-9">
                                        <input type="text" name="" id="room_name_create" class="form-control form-control-sm">
                                    </div>
                                </div>
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-outline-secondary btn-sm" data-dismiss="modal">Đóng</button>
                            <button type="button" class="btn btn-warning btn-sm" id="refresh_save_room_btn" style="margin-left: 0.5rem !important;">Làm mới</button>
                            <button type="button" class="btn btn-primary btn-sm" id="save_room_btn" style="margin-left: 0.5rem !important;">Lưu</button>
                        </div>
                    </div>
                </div>
            </div>

            {{-- Modal Chỉnh sửa --}}
            <div class="modal fade" id="modal_edit_apartment" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel">Chỉnh sửa</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <form action="" id="form_edit_apartment">
                                <input type="hidden" name="" id="apartment_id_edit" value="">
                                <div class="row">
                                    <div class="col-3">
                                        <label for="apartment_name_edit" class="col-form-label float-right">Tên chung cư</label>
                                    </div>
                                    <div class="col-9">
                                        <input type="text" name="" id="apartment_name_edit" class="form-control form-control-sm">
                                    </div>
                                    {{-- <div class="col-1 p-0">
                                        <button type="button" class="btn btn-outline-info btn-sm">
                                            <i class="fa-solid fa-plus"></i>
                                        </button>
                                    </div> --}}
                                </div>
                                <div class="row mt-2">
                                    <div class="col-3">
                                        <label for="list_block_edit" class="col-form-label float-right pb-0" style="line-height: 1;">Nhà</label>
                                        <br>
                                        <button type="button" class="btn btn-outline-info btn-sm float-right mt-2" id="create_block_btn">
                                            <i class="fa-solid fa-plus"></i>
                                        </button>
                                    </div>
                                    <div class="col-9">
                                        <select name="" id="list_block_edit" class="form-control form-control-sm" multiple></select>
                                    </div>
                                </div>
                                <div class="row mt-2">
                                    <div class="col-3">
                                        <label for="list_floor_edit" class="col-form-label float-right pb-0" style="line-height: 1;">Tầng</label>
                                        <br>
                                        <button type="button" class="btn btn-outline-info btn-sm float-right mt-2" id="create_floor_btn">
                                            <i class="fa-solid fa-plus"></i>
                                        </button>
                                    </div>
                                    <div class="col-9">
                                        <select name="" id="list_floor_edit" class="form-control form-control-sm" multiple>
                                        </select>
                                    </div>
                                </div>
                                <div class="row mt-2">
                                    <div class="col-3">
                                        <label for="list_room_edit" class="col-form-label float-right pb-0" style="line-height: 1;">Căn hộ</label>
                                        <br>
                                        <button type="button" class="btn btn-outline-info btn-sm float-right mt-2" id="create_room_btn">
                                            <i class="fa-solid fa-plus"></i>
                                        </button>
                                    </div>
                                    <div class="col-9">
                                        <select name="" id="list_room_edit" class="form-control form-control-sm" multiple>
                                        </select>
                                    </div>
                                </div>
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-outline-secondary btn-sm" data-dismiss="modal">Đóng</button>
                            <button type="button" class="btn btn-warning btn-sm" id="refresh_update_apartment_btn" style="margin-left: 0.5rem !important;">Làm mới</button>
                            <button type="button" class="btn btn-success btn-sm" id="update_apartment_btn" style="margin-left: 0.5rem !important;">Cập nhật</button>
                        </div>
                    </div>
                </div>
            </div>

            {{-- Modal Xóa --}}
            <div class="modal fade" id="modal_delete_apartment" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel">Xác nhận</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <input type="hidden" id="apartment_id_delete" value="">
                            <span id="confirm_message"></span>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-outline-secondary btn-sm" data-dismiss="modal">Đóng</button>
                            <button type="button" class="btn btn-danger btn-sm" id="destroy_apartment_btn" style="margin-left: 0.5rem !important;">Xác nhận xóa</button>
                        </div>
                    </div>
                </div>
            </div>

            {{-- Modal Xem chi tiết --}}
            <div class="modal fade" id="modal_show_apartment" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel">Xem chi tiết</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <form action="" id="form_show_apartment">
                                <div class="row align-items-center">
                                    <div class="col-3">
                                        <label for="apartment_name_show" class="col-form-label float-right">Tên chung cư:</label>
                                    </div>
                                    <div class="col-9">
                                        {{-- <input type="text" name="" id="apartment_name_show" class="form-control form-control-sm"> --}}
                                        <span class="text-danger" id="apartment_name_show"></span>
                                    </div>
                                </div>
                                <div class="row mt-2">
                                    <div class="col-3">
                                        <label for="list_block_show" class="col-form-label float-right">Nhà:</label>
                                    </div>
                                    <div class="col-9">
                                        <select name="" class="form-control form-control-sm" id="list_block_show" multiple disabled>
                                        </select>
                                    </div>
                                    {{-- <div class="col-1 p-0">
                                        <button type="button" class="btn btn-outline-info btn-sm">
                                            <i class="fa-solid fa-plus"></i>
                                        </button>
                                    </div> --}}
                                </div>  
                                <div class="row mt-2">
                                    <div class="col-3">
                                        <label for="list_floor_show" class="col-form-label float-right">Tầng:</label>
                                    </div>
                                    <div class="col-9">
                                        <select name="" class="form-control form-control-sm" id="list_floor_show" multiple disabled>
                                        </select>
                                    </div>
                                </div>
                                <div class="row mt-2">
                                    <div class="col-3">
                                        <label for="list_room_show" class="col-form-label float-right">Căn hộ:</label>
                                    </div>
                                    <div class="col-9">
                                        <select name="" class="form-control form-control-sm" id="list_room_show" multiple disabled>
                                        </select>
                                    </div>
                                </div>
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-outline-secondary btn-sm" data-dismiss="modal">Đóng</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
@endsection

@section('script')
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="{{ asset('./js/index.js') }}"></script>
<script>
    $(document).ready(function() {
        $(document).off('click', '#create_apartment_btn').on('click', '#create_apartment_btn', function(e) {
            e.preventDefault();
            $('#modal_create_apartment').modal('show');

            $(document).off('shown.bs.modal', '#modal_create_apartment').on('shown.bs.modal', '#modal_create_apartment', function() {
                $.ajax({
                    type: "GET",
                    url: "{{ route('apartment.get.list.block.to.modal') }}",
                    success: function (res) {
                        if(res.status == 200) {
                            listCbbName($('#list_block_create'), res.blocks);
                        }
                    }
                });
                $.ajax({
                    type: "GET",
                    url: "{{ route('apartment.get.list.floor.to.modal') }}",
                    success: function (res) {
                        if(res.status == 200) {
                            listCbbName($('#list_floor_create'), res.floors);
                        }
                    }
                });
                $.ajax({
                    type: "GET",
                    url: "{{ route('apartment.get.list.room.to.modal') }}",
                    success: function (res) {
                        if(res.status == 200) {
                            listCbbName($('#list_room_create'), res.rooms);
                        }
                    }
                });
            });

            $(document).off('click', '#refresh_save_apartment_btn').on('click', '#refresh_save_apartment_btn', function(e) {
                e.preventDefault();
                $('#form_create_apartment').find(':input').val('');
                $(this).off('click');
            });

            store_3_1('#modal_create_apartment', '#modal_create_block', '#form_create_block', '#create_block_btn', '#refresh_save_block_btn', '#save_block_btn', '#block_name_create', "{{ route('apartment.store.block') }}", "{{ csrf_token() }}", '#refresh_input_search_btn', 'tên Nhà');
            store_3_1('#modal_create_apartment', '#modal_create_floor', '#form_create_floor', '#create_floor_btn', '#refresh_save_floor_btn', '#save_floor_btn', '#floor_name_create', "{{ route('apartment.store.floor') }}", "{{ csrf_token() }}", '#refresh_input_search_btn', 'số Tầng');
            store_3_1('#modal_create_apartment', '#modal_create_room', '#form_create_room', '#create_room_btn', '#refresh_save_room_btn', '#save_room_btn', '#room_name_create', "{{ route('apartment.store.room') }}", "{{ csrf_token() }}", '#refresh_input_search_btn', 'tên Căn hộ');

            $(document).prop('disabled', false).off('click', '#save_apartment_btn').on('click', '#save_apartment_btn', function(e) {
                e.preventDefault();
                $(this).prop('disabled', true);
                let name = $('#apartment_name_create');
                let listBlockName = [];
                let listFloorName = [];
                let listRoomName = [];
                $('#list_block_create > option:selected').each(function() {
                    listBlockName.push($(this).text());
                });
                $('#list_floor_create > option:selected').each(function() {
                    listFloorName.push($(this).text());
                });
                $('#list_room_create > option:selected').each(function() {
                    listRoomName.push($(this).text());
                });

                if(!validateField('#apartment_name_create', $(this), 'input', 'Vui lòng nhập tên Chung cư')) return;
                $.ajax({
                    type: "POST",
                    url: "{{ route('apartment.store') }}",
                    data: {
                        name: name.val(),
                        listBlockName: listBlockName,
                        listFloorName: listFloorName,
                        listRoomName: listRoomName,
                        _token: "{{ csrf_token() }}",
                    },
                    success: function (res) {
                        if(res.status == 200) {
                            alert(res.message);
                            $('#modal_create_apartment').modal('hide');
                            $('#save_apartment_btn').prop('disabled', false);
                            $('#refresh_input_search_btn').click();

                        }
                        if(res.status == 400 || res.status == 401 || res.status == 402 || res.status == 403 || res.status == 404) {
                            alert(res.message);
                            $('#save_apartment_btn').prop('disabled', false);
                        }
                    }
                });
            });

            $(document).off('hidden.bs.modal', '#modal_create_apartment').on('hidden.bs.modal', '#modal_create_apartment', function() {
                $('#form_create_apartment').find(':input').val('');
                $('#form_create_apartment').find('.border.border-danger').removeClass('border border-danger');
                $('#form_create_apartment').find('.text-danger').remove();
            });
        });

        $(document).off('click', '#edit_apartment_btn').on('click', '#edit_apartment_btn', function(e) {
            e.preventDefault();
            $('#modal_edit_apartment').modal('show');
            let name = $('#apartment_name_edit');
            let id = $(this).val();
            let url = "{{ route('apartment.edit', ':id') }}";
            url = url.replace(':id', id);

            $(document).off('shown.bs.modal', '#modal_edit_apartment').on('shown.bs.modal', '#modal_edit_apartment', function() {
                $.ajax({
                    type: "GET",
                    url: url,
                    success: function (res) {
                        if(res.status == 200) {
                            name.val(res.apartment.name);
                            $('#apartment_id_edit').val(res.apartment.id);
                            listCbbName($('#list_block_edit'), res.blocks);
                            if(res.blockOfApartment != null) {
                                let listBlock = $('#list_block_edit > option');
                                $.each(res.blockOfApartment, function(key, value) {
                                    listBlock.each(function() {
                                        if($(this).text() == value.name) {
                                            $(this).prop('selected', true);
                                        }
                                    });
                                });
                            }
                            listCbbName($('#list_floor_edit'), res.floors);
                            if(res.floorOfBlock != null) {
                                let listBlock = $('#list_floor_edit > option');
                                $.each(res.floorOfBlock, function(key, value) {
                                    listBlock.each(function() {
                                        if($(this).text() == value.name) {
                                            $(this).prop('selected', true);
                                        }
                                    });
                                });
                            }
                            listCbbName($('#list_room_edit'), res.rooms);
                            if(res.roomOfFloor != null) {
                                let listRoom = $('#list_room_edit > option');
                                $.each(res.roomOfFloor, function(key, value) {
                                    listRoom.each(function() {
                                        if($(this).text() == value.name) {
                                            $(this).prop('selected', true);
                                        }
                                    });
                                });
                            }
                        }
                    }
                });

                store_3_1('#modal_edit_apartment', '#modal_create_block', '#form_create_block', '#create_block_btn', '#refresh_save_block_btn', '#save_block_btn', '#block_name_create', "{{ route('apartment.store.block') }}", "{{ csrf_token() }}", '#refresh_input_search_btn', 'tên Nhà');
                store_3_1('#modal_edit_apartment', '#modal_create_floor', '#form_create_floor', '#create_floor_btn', '#refresh_save_floor_btn', '#save_floor_btn', '#floor_name_create', "{{ route('apartment.store.floor') }}", "{{ csrf_token() }}", '#refresh_input_search_btn', 'số Tầng');
                store_3_1('#modal_edit_apartment', '#modal_create_room', '#form_create_room', '#create_room_btn', '#refresh_save_room_btn', '#save_room_btn', '#room_name_create', "{{ route('apartment.store.room') }}", "{{ csrf_token() }}", '#refresh_input_search_btn', 'tên Căn hộ');
            });

            $(document).off('click', '#refresh_update_apartment_btn').on('click', '#refresh_update_apartment_btn', function(e) {
                e.preventDefault();
                $('#form_edit_apartment').find(':input').val('');
                $(this).off('click');
            });

            $(document).prop('disabled', false).off('click', '#update_apartment_btn').on('click', '#update_apartment_btn', function(e) {
                e.preventDefault();
                let listBlockName = [];
                let listFloorName = [];
                let listRoomName = [];
                $('#list_block_edit > option:selected').each(function() {
                    listBlockName.push($(this).text());
                });
                $('#list_floor_edit > option:selected').each(function() {
                    listFloorName.push($(this).text());
                });
                $('#list_room_edit > option:selected').each(function() {
                    listRoomName.push($(this).text());
                });
                $(this).prop('disabled', true);
                if(!validateField('#apartment_name_edit', $(this), 'input', 'Vui lòng nhập tên Chung cư')) return;
                url = "{{ route('apartment.update', ':id') }}";
                url = url.replace(':id', id);
                $.ajax({
                    type: "PATCH",
                    url: url,
                    data: {
                        id: id,
                        name: name.val(),
                        listBlockName: listBlockName,
                        listFloorName: listFloorName,
                        listRoomName: listRoomName,
                        _token: "{{ csrf_token() }}",
                    },
                    success: function (res) {
                        // console.log(typeof res.test);return;
                        if(res.status == 200) {
                            alert(res.message);
                            $('#modal_edit_apartment').modal('hide');
                            $('#update_apartment_btn').prop('disabled', false);
                            $('#refresh_input_search_btn').click();
                        }
                        if(res.status == 400 || res.status == 401 || res.status == 402 || res.status == 403 || res.status == 404) {
                            alert(res.message);
                            $('#update_apartment_btn').prop('disabled', false);
                        }
                    }
                });
            });

            $(document).off('hidden.bs.modal', '#modal_edit_apartment').on('hidden.bs.modal', '#modal_edit_apartment', function() {
                $('#form_edit_apartment').find('.border.border-danger').removeClass('border border-danger');
                $('#form_edit_apartment').find('.text-danger').remove();
                $('#list_block_edit > option').prop('selected', false);
            });
        });

        $(document).off('click', '#delete_apartment_btn').on('click', '#delete_apartment_btn', function(e) {
            e.preventDefault();
            $('#modal_delete_apartment').modal('show');
            $('#confirm_message').text('Chắc chắn muốn xóa Chung cư này?');
            let id = $(this).val();
            $('#apartment_id_delete').val(id);
            let url = "{{ route('apartment.destroy', ':id') }}";
            url = url.replace(':id', id);

            $(document).prop('disabled', false).off('click', '#destroy_apartment_btn').on('click', '#destroy_apartment_btn', function(e) {
                e.preventDefault();
                $(this).prop('disabled',  true);
                $.ajax({
                    type: "DELETE",
                    url: url,
                    data: {
                        _token: "{{ csrf_token() }}",
                    },
                    success: function (res) {
                        if(res.status == 200) {
                            alert(res.message);
                            $('#modal_delete_apartment').modal('hide');
                            $('#destroy_apartment_btn').off('click');
                            $('#destroy_apartment_btn').prop('disabled', false);
                            $('#refresh_input_search_btn').click();
                        }
                        if(res.status == 400) {
                            alert(res.message);
                            $('#destroy_apartment_btn').off('click');
                            $('#destroy_apartment_btn').prop('disabled', false);
                        }
                    }
                });
            });
        });

        $(document).off('change', '#check_all').on('change', '#check_all', function() {
            let isChecked = $(this).prop('checked');
            $('.check_box').prop('checked', isChecked);
            countCheckedNumber()
        });

        $(document).off('change', '.check_box').on('change', '.check_box', function() {
            let checkBoxItemNumber = $('.check_box').length === $('input:checkbox[name="ids"]:checked').length;
            $('#check_all').prop('checked', checkBoxItemNumber);
            countCheckedNumber()
        });

        function countCheckedNumber() {
            let checkedCount = $('input:checkbox[name="ids"]:checked').length;
            if(checkedCount > 0)
                $('#delete_many_apartment_btn').prop('hidden', false);
            else
                $('#delete_many_apartment_btn').prop('hidden', true);
        }

        $(document).off('click', '#delete_many_apartment_btn').on('click', '#delete_many_apartment_btn', function(e) {
            e.preventDefault();
            let allIds = [];
            $('input:checkbox[name="ids"]:checked').each(function() {
                allIds.push($(this).val());
            });
            $('#modal_delete_apartment').modal('show');
            $('#confirm_message').text('Chắc chắn muốn xóa những Chung cư này?');

            $(document).prop('disabled', false).off('click', '#destroy_apartment_btn').on('click', '#destroy_apartment_btn', function(e) {
                e.preventDefault();
                $(this).prop('disabled', true);
                $.ajax({
                    type: "DELETE",
                    url: "{{ route('apartment.delete.many') }}",
                    data: {
                        allIds: allIds,
                        _token: '{{ csrf_token() }}',
                    },
                    success: function (res) {
                        if(res.status == 200) {
                            alert(res.message);
                            $('#modal_delete_apartment').modal('hide');
                            $('#destroy_apartment_btn').prop('disabled', false);
                            $('#refresh_input_search_btn').click();
                        } else if(res.status == 400) {
                            alert(res.message);
                            $('#destroy_apartment_btn').prop('disabled', false);
                        }
                    }
                });
            });
        });

        $(document).off('click', '.pagination a').on('click', '.pagination a', function(e) {
            e.preventDefault();
            let page = $(this).attr('href').split('?page=')[1];
            let numRow = $('#row').val();
            $.ajax({
                url: "/admins/categories/apartment/fetch?page=" + page,
                data: {
                    numRow: numRow > 0 ? numRow : 0,
                },
                success: function (res) {
                    $('#list_apartment_table').html(res);
                    $('#row').val(numRow);
                }
            });
        });

        $(document).off('change', '#row').on('change', '#row', function() {
            let numRow = $(this).val();
            $.ajax({
                url: "{{ route('get.row.apartment') }}",
                data: {
                    numRow: numRow,
                },
                success: function (res) {
                    $('#list_apartment_table').html(res);
                    $('#row').val(numRow);
                }
            });
        });

        $(document).prop('disabled', false).off('click', '#refresh_input_search_btn').on('click', '#refresh_input_search_btn', function(e) {
            e.preventDefault();
            $(this).prop('disabled', true);
            $('#form_search').find(':input').val('');
            $('#delete_many_apartment_btn').prop('hidden', true);
            $('#row').val('5').change();
            if($('#links').hasClass('d-none')) 
                $('#links').removeClass('d-none');
            if($('#row').hasClass('d-none')) 
                $('#row').removeClass('d-none');
            $.ajax({
                type: "GET",
                url: "{{ route('get.list.apartment') }}",
                success: function (res) {
                    if(res.status == 200) {
                        $('#list_apartment').html('');
                        $.each(res.apartments, function(key, value) {
                            $('#list_apartment').append('\
                                <option>'+ value.name +'</option>\
                            ');
                        });
                    }
                }
            });
            $(this).prop('disabled', false);
        });
        $('#refresh_input_search_btn').click();

        $(document).prop('disabled', false).off('click', '#search_apartment_btn').on('click', '#search_apartment_btn', function(e) {
            e.preventDefault();
            $(this).prop('disabled', true);
            let apartmentName = $('input[name="apartment"]').val();
            $.ajax({
                type: "GET",
                url: "{{ route('apartment.search') }}",
                data: {
                    apartmentName: apartmentName,
                },
                success: function (res) {
                    $('#list_apartment_table').html(res);
                    // $('#links').addClass('d-none');
                    // $('#row').addClass('d-none');
                    $('#row').val('15');
                    $('#search_apartment_btn').prop('disabled', false);
                }
            });
        });

        $(document).off('click', '#show_apartment_btn').on('click', '#show_apartment_btn', function(e) {
            e.preventDefault();
            $('#modal_show_apartment').modal('show');
            let apartmentName = $('#apartment_name_show');
            let apartmentId = $(this).val();
            let url = "{{ route('apartment.show', ':id') }}";
            url = url.replace(':id', apartmentId);
            $.ajax({
                type: "GET",
                url: url,
                success: function (res) {
                    if(res.status == 200) {
                        apartmentName.text(res.apartment.name);
                        listCbbName($('#list_block_show'), res.blockOfApartment);
                        listCbbName($('#list_floor_show'), res.floorOfBlock);
                        listCbbName($('#list_room_show'), res.roomOfFloor);
                    }
                }
            });
        });
    });
</script>
@endsection
