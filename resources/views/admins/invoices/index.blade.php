@extends('admins.layouts.master')

@section('title')
    Danh sách biên lai
@endsection

@section('style')
<style>
    fieldset.scheduler-border {
        border: 1px groove #ddd !important;
        padding: 0 1.4em .2em 1.4em !important;
        margin: 0 !important;
        -webkit-box-shadow: 0px 0px 0px 0px #000;
                box-shadow: 0px 0px 0px 0px #000;
    }

    legend.scheduler-border {
        /* font-size: 1.2em !important; */
        /* font-weight: bold !important; */
        /* text-align: left !important; */
        width: auto;
        padding: 0 10px;
        border-bottom: none;
    }

    #modal_preview > .modal-dialog {
        max-width: 811px !important;
    }

    #form_preview_invoice {
        position: relative;
    }

    #form_preview_invoice::before {
        background-image: url("{{ asset('images/trong_dong.jpg') }}"); 
        background-position: center;
        background-repeat: no-repeat;
        background-size: contain;
        content : "";
        display: block;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 85%;
        height: 85%;
        opacity : 0.5;
        z-index: 0;
    }

    /* table {
        position: relative;
    }
    table > thead > tr {
        position: sticky;
        top: 0;
        box-shadow: 0 2px 2px -1px rgba(0, 0, 0, 0.4);
        background-color: #333333;
        z-index: 999;
    } */
</style>
@endsection

@section('content')
<!--# Page header -->
<div class="page-header page-header-light">
    <div class="page-header-content header-elements-lg-inline">
        <div class="page-title d-flex"></div>
        <div class="header-elements d-none">
            <div class="d-flex justify-content-center">
                <a href="#" class="btn btn-link btn-float text-body"><i class="icon-bars-alt text-primary"></i><span>Thống kê</span></a>
                <a href="#" class="btn btn-link btn-float text-body"><i class="icon-calculator text-primary"></i> <span>Hóa đơn</span></a>
                <a href="#" class="btn btn-link btn-float text-body"><i class="icon-calendar5 text-primary"></i> <span>Lịch trình</span></a>
            </div>
        </div>
    </div>
    <div class="breadcrumb-line breadcrumb-line-light header-elements-lg-inline">
        <div class="d-flex">
            <div class="breadcrumb">
                <a href="index.html" class="breadcrumb-item"><i class="icon-home2 mr-2"></i> Trang chủ</a>
                <a href="alpaca_advanced.html" class="breadcrumb-item">Biên lai</a>
                <!-- <span class="breadcrumb-item active">Trang 1</span> -->
            </div>
            <a href="#" class="header-elements-toggle text-body d-lg-none"><i class="icon-more"></i></a>
        </div>
    </div>
</div>
<!--# /page header -->

<div class="content">
    <div class="card mb-4">
        <div class="container mb-2">
            <div id="success_message" class="mt-2">
            </div>
        
            <div>
                <fieldset class="scheduler-border">
                    <legend class="scheduler-border">Tìm kiếm</legend>
                    <form action="" method="" id="form_search">
                        <div class="row">
                            <div class="col-6">
                                <div class="form-group">
                                    <div class="row align-items-center">
                                        <div class="col-4">
                                            <label for="" class="float-right">Mẫu số</label>
                                        </div>
                                        <div class="col-8">
                                            <select name="" id="form_no" class="form-control form-control-sm custom-select">
                                                <option value="1c21tnh">1C21TNH</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="form-group">
                                    <div class="row align-items-center">
                                        <div class="col-4">
                                            <label for="" class="float-right">Tên chung cư</label>
                                        </div>
                                        <div class="col-8">
                                            <select name="" id="apartment" class="form-control form-control-sm custom-select">
                                                <option value="0">--- Chọn chung cư ---</option>
                                                @foreach ($apartments as $apartment)
                                                    <option value="{{ $apartment->id }}">{{ $apartment->name }}</option>
                                                @endforeach
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-6">
                                <div class="form-group">
                                    <div class="row align-items-center">
                                        <div class="col-4">
                                            <label for="" class="float-right">Ký hiệu</label>
                                        </div>
                                        <div class="col-8">
                                            <input type="text" name="" id="serial_no" class="form-control form-control-sm text-uppercase">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="form-group">
                                    <div class="row align-items-center">
                                        <div class="col-4">
                                            <label for="" class="float-right">Nhà</label>
                                        </div>
                                        <div class="col-8">
                                            <select name="" id="block" class="form-control form-control-sm custom-select">
                                                <option value="0">--- Chọn nhà ---</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-6">
                                <div class="form-group">
                                    <div class="row align-items-center">
                                        <div class="col-4">
                                            <label for="" class="float-right">Số BL</label>
                                        </div>
                                        <div class="col-8">
                                            <input type="number" name="" id="invoice_no" class="form-control form-control-sm">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="form-group">
                                    <div class="row align-items-center">
                                        <div class="col-4">
                                            <label for="" class="float-right">Tầng</label>
                                        </div>
                                        <div class="col-8">
                                            <select name="" id="floor" class="form-control form-control-sm custom-select">
                                                <option value="0">--- Chọn tầng ---</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-6">
                                <div class="form-group">
                                    <div class="row align-items-center">
                                        <div class="col-4">
                                            <label for="" class="float-right">Trạng thái</label>
                                        </div>
                                        <div class="col-8">
                                            <select name="" id="status" class="form-control form-control-sm custom-select">
                                                <option value="0">Chưa ký</option>
                                                <option value="1">Đã ký</option>
                                                <option value="2">Đã phát hành</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="form-group">
                                    <div class="row align-items-center">
                                        <div class="col-4">
                                            <label for="" class="float-right">Căn hộ</label>
                                        </div>
                                        <div class="col-8">
                                            <select name="" id="room" class="form-control form-control-sm custom-select">
                                                <option value="0">--- Chọn căn hộ ---</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-6">
                                <div class="form-group">
                                    <div class="row align-items-center">
                                        <div class="col-4">
                                            <label for="" class="float-right">Ngày tạo BL</label>
                                        </div>
                                        <div class="col-8">
                                            <input type="date" name="" id="date_created" class="form-control form-control-sm">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="form-group">
                                    <div class="row align-items-center">
                                        <div class="col-4">
                                            <label for="" class="float-right">Tên khách hàng</label>
                                        </div>
                                        <div class="col-8">
                                            <input type="text" name="" id="customer_name" class="form-control form-control-sm" disabled>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-6">
                                <div class="form-group">
                                    <div class="row align-items-center">
                                        <div class="col-4">
                                            <label for="" class="float-right">Người tạo</label>
                                        </div>
                                        <div class="col-8">
                                            <select name="" id="creator" class="form-control form-control-sm custom-select">
                                                <option value="0">--- Chọn người tạo ---</option>
                                                @foreach ($accounts as $account)
                                                    <option value="{{ $account->id }}">{{ $account->username }}</option>
                                                @endforeach
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="form-group">
                                    <div class="row align-items-center">
                                        <div class="col-4">
                                            <label for="" class="float-right">Số điện thoại</label>
                                        </div>
                                        <div class="col-8">
                                            <input type="text" name="" id="customer_phone_number" class="form-control form-control-sm">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-6">
                                {{-- <div class="form-group">
                                    <div class="row align-items-center">
                                        <div class="col-4">
                                            <label for="" class="float-right">Tên chung cư</label>
                                        </div>
                                        <div class="col-8">
                                            <select name="" id="" class="form-control form-control-sm">
                                                <option value="0">--- Chọn chung cư ---</option>
                                            </select>
                                        </div>
                                    </div>
                                </div> --}}
                            </div>
                            <div class="col-6">
                                <div class="form-group">
                                    <div class="row align-items-center">
                                        <div class="col-4">
                                            
                                        </div>
                                        <div class="col-8">
                                            <button type="button" class="btn btn-success btn-sm" id="search_invoice_btn">
                                                <i class="fa-solid fa-magnifying-glass mr-1"></i>
                                                Tìm kiếm
                                            </button>
                                            <button type="button" class="btn btn-warning btn-sm" id="refresh_input_search_btn">
                                                <i class="fa-solid fa-rotate mr-1"></i>
                                                Làm mới
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </fieldset>
            </div>

            <div class="mt-3 d-flex justify-content-between">
                <div>
                    <select name="" class="form-control form-control-sm custom-select" id="row">
                        <option value="5">5 hàng</option>
                        <option value="10">10 hàng</option>
                        <option value="15">15 hàng</option>
                        <option value="20">20 hàng</option>
                    </select>
                </div>
        
                <div>
                    <button type="button" class="btn btn-danger btn-sm" id="delete_unsigned_invoices">
                        <i class="fa-solid fa-xmark mr-1"></i>
                        Xóa BL chưa ký
                    </button>
                    <button type="button" class="btn btn-warning btn-sm" id="btn_publish">
                        <i class="fa-solid fa-check mr-1"></i>
                        Phát hành BL
                    </button>
                    <button type="button" class="btn btn-danger btn-sm" id="delete_many_btn">
                        <i class="fa-solid fa-xmark mr-1"></i>
                        Xóa hàng loạt
                    </button>
                    {{-- <button type="button" class="btn btn-success btn-sm">
                        <i class="fa-regular fa-paper-plane mr-1"></i>
                        Gửi mail
                    </button> --}}
                    {{-- <button type="button" class="btn btn-info btn-sm">
                        <i class="fa-regular fa-copy mr-1"></i>
                        Tạo hàng loạt
                    </button> --}}
                    <button type="button" class="btn btn-info btn-sm" id="import_excel_modal_btn">
                        <i class="fa-regular fa-file-excel mr-1"></i>
                        Tạo bằng file Excel
                    </button>
                    <a href="{{ url('/admins/invoice/create') }}" class="btn btn-info btn-sm">
                        <i class="fa-solid fa-plus mr-1"></i>
                        Tạo mới
                    </a>
                </div>
            </div>
            <div class="mt-3">
                <i class="fa-solid fa-paper-plane" style="color: #868686;"></i>
                <span class="text-uppercase" style="color: #868686; font-weight: 500;">Danh sách biên lai</span>
            </div>

            <div id="list_invoice_table">
                @include('admins.invoices.pagination')
            </div>

            {{-- Modal Xem trước BL --}}
            <div class="modal fade" id="modal_preview" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        {{-- <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div> --}}
                        <div class="modal-body p-0">
                            {{-- <div class="container"> --}}
                                <div class="">
                                    <div class="text-primary" id="form_preview_invoice">
                                        <div class="mt-2 ml-1 row">
                                            <input type="hidden" id="invoice_id_preview_invoice" value="">
                                            <div class="col-3">
                                                <span class="font-weight-bold text-uppercase" style="font-size: 12px; position: relative; top: -5px;">Trung tâm quản lý & khai</span>
                                                <br>
                                                <span class="font-weight-bold text-uppercase" style="font-size: 12px; position: relative; top: -11px;">thác nhà ở Đà Nẵng</span>
                                                <br>
                                                <div style="position: relative; top: -5px;">
                                                    <span class="" style="font-weight: 500; font-size: 13px; position: relative; top: -12px;">Mã số thuế:</span>
                                                    <span class="font-weight-bold" style="font-size: 13px; position: relative; top: -12px;">0401931849</span>
                                                </div>
                                                <div style="position: relative; top: -11px;">
                                                    <span class="" style="font-weight: 500; font-size: 13px; position: relative; top: -12px;">Địa chỉ:</span>
                                                    <span class="" style="font-size: 13px; position: relative; top: -12px;"></span>
                                                </div>
                                            </div>
                                            <div class="col-6">
                                                <h6 class="text-uppercase text-center font-weight-bold mb-1">Cộng hòa xã hội chủ nghĩa việt nam</h6>
                                                <p class="text-center font-weight-bold mb-0" style="font-size: 14px; text-decoration: underline;">Độc lập - Tự do - Hạnh phúc</p>
                                                {{-- <center>
                                                    <i class="text-center" style="font-size: 14px;">
                                                        Ngày <span id="date_preview_invoice"></span> 
                                                        tháng <span id="month_preview_invoice"></span> 
                                                        năm <span id="year_preview_invoice"></span>
                                                    </i>
                                                </center> --}}
                                            </div>
                                            <div class="col-3" style="position: relative; top: -4px;">
                                                <span class="justify-content-end ml-2" style="font-size: 14px; font-weight: 500;">Mẫu số:</span>
                                                <span class="justify-content-end text-uppercase" style="font-size: 14px; font-weight: 500;" id="form_no_preview_invoice"></span>
                                                <br>
                                                <span class="justify-content-end ml-2" style="font-size: 14px; font-weight: 500;">Ký hiệu:</span>
                                                <span class="justify-content-end text-uppercase" style="font-size: 14px; font-weight: 500;" id="serial_no_preview_invoice"></span>
                                                <br>
                                                <span class="justify-content-end ml-2" style="font-size: 14px; font-weight: 500;">Số:</span>
                                                <span class="justify-content-end" style="font-size: 14px; font-weight: 500; color: red;" id="invoice_no_preview_invoice"></span>
                                            </div>
                                        </div>
                        
                                        <div style="position: relative; top: -15px;">
                                            <center>
                                                <h4 class="text-uppercase font-weight-bold" style="color: red;">Biên lai thu phí, lệ phí</h4>
                                                <small class="font-weight-bold" style="font-size: 14px; position: relative; top: -12px;">Tên thủ tục</small>
                                                <br>
                        
                                                <div style="position: relative; top: -15px;">
                                                    <small class="font-weight-bold" style="font-size: 13px;">Ngày</small>
                                                    <small class="font-weight-bold" id="date_preview_invoice" style="font-size: 14px; color: black;"></small> 
                        
                                                    <small class="font-weight-bold" style="font-size: 13px;">tháng</small>
                                                    <small class="font-weight-bold" id="month_preview_invoice" style="font-size: 14px; color: black;"></small> 
                        
                                                    <small class="font-weight-bold" style="font-size: 13px;">năm</small>
                                                    <small class="font-weight-bold" id="year_preview_invoice" style="font-size: 14px; color: black;"></small> 
                                                </div>
                                            </center>
                                        </div>
                        
                                        {{-- <hr class="border-danger mt-1 mb-1"> --}}
                                        {{-- <div class="mt-1 ml-3">
                                            <div class="d-flex">
                                                <span>Tên đơn vị hoặc: </span>
                                                <span class="font-weight-bold" id="">&nbsp;Trung tâm quản lý & khai thác nhà ở Đà Nẵng</span>
                                            </div>
                                            <div class="d-flex">
                                                <span>Địa chỉ: </span>
                                                <span class="font-weight-bold">&nbsp;</span>
                                            </div>
                                            <div class="d-flex">
                                                <span>Số tài khoản: </span>
                                                <span class="font-weight-bold"></span>
                                            </div>
                                            <div class="row">
                                                <div class="col-6">
                                                    <span>Điện thoại: </span>
                                                    <span class="font-weight-bold">&nbsp;</span>
                                                </div>
                                                <div class="col-6">
                                                    <span>Mã số thuế: </span>
                                                    <span class="font-weight-bold">&nbsp;</span>
                                                </div>
                                            </div>
                                        </div> --}}
                        
                                        {{-- <hr class="border-danger mt-1 mb-1"> --}}
                                        <div class="mt-1 ml-3" style="font-size: 15px; position: relative; top: -25px;">
                                            <div class="d-flex">
                                                <span>Tên đơn vị hoặc người nộp tiền:&nbsp;</span>
                                                <span class="" id="customer_name_preview_invoice" style="color: black;"></span>
                                            </div>
                                            <div class="row mt-1">
                                                <div class="col-3">
                                                    <span>Căn hộ:</span>
                                                    <span class="" id="room_preview_invoice" style="color: black;"></span>
                                                </div>
                                                <div class="col-2">
                                                    <span>Tầng:</span>
                                                    <span class="" id="floor_preview_invoice" style="color: black;"></span>
                                                </div>
                                                <div class="col-2">
                                                    <span>Nhà:</span>
                                                    <span class="" id="block_preview_invoice" style="color: black;"></span>
                                                </div>
                                                <div class="col-5">
                                                    <span>Tên chung cư:</span>
                                                    <span class="" id="apartment_preview_invoice" style="color: black;"></span>
                                                </div>
                                            </div>
                                            <div class="d-flex mt-1">
                                                <span>Tên loại phí, lệ phí:&nbsp;</span>
                                                <span class="" id="fee_name_preview_invoice" style="color: black;"></span>
                                            </div>
                                            <div class="d-flex mt-1">
                                                <span>Số tiền nộp:&nbsp;</span>
                                                <span class="font-weight-bold" id="fee_amount_preview_invoice" style="color: black;"></span>
                                            </div>
                                            <div class="d-flex mt-1">
                                                <span>Hình thức thanh toán:&nbsp;</span>
                                                <span class="" id="pay_method_preview_invoice" style="color: black;"></span>
                                            </div>
                                            <div class="d-flex mt-1">
                                                <span>Ghi bằng chữ:&nbsp;</span>
                                                <span class="" id="total_in_words_preview_invoice" style="color: black;"></span>
                                            </div>
                                        </div>
                                        {{-- <table class="table table-bordered mt-1 mb-0" id="vat_invoice_table">
                                            <thead>
                                                <tr class="table-danger">
                                                    <th scope="col" style="max-width: 40px !important;">STT</th>
                                                    <th scope="col">Tên hàng hóa, dịch vụ</th>
                                                    <th scope="col" class="text-center" style="max-width: 50px !important;">ĐVT</th>
                                                    <th scope="col" style="max-width: 50px !important;">Số lượng</th>
                                                    <th scope="col" class="text-center">Đơn giá</th>
                                                    <th scope="col" class="text-center">Thành tiền</th>
                                                </tr>
                                            </thead>
                                            <tbody id="table_data_preview_invoice">
                                                
                                            </tbody>
                                        </table> --}}
                                        {{-- <div class="mt-1">
                                            <div class="row">
                                                <div class="col-8"></div>
                                                <div class="col-2">
                                                    <span class="float-right">Tổng cộng:</span>
                                                </div>
                                                <div class="col-2 p-0">
                                                    <span class="font-weight-bold" id="total_before_tax_preview_invoice"></span>
                                                </div>
                                            </div>
                                        </div>
                                        <hr class="border-danger mt-1 mb-1">
                                        <div class="mt-1">
                                            <div class="row">
                                                <div class="col-3"></div>
                                                <div class="col-2">
                                                    <span class="float-right">Thuế GTGT:</span>
                                                </div>
                                                <div class="col-2 p-0">
                                                    <span class="font-weight-bold" id="vat_tax_preview_invoice"></span>
                                                </div>
                                                <div class="col-3">
                                                    <span class="float-right">Tổng tiền thuế:</span>
                                                </div>
                                                <div class="col-2 p-0">
                                                    <span class="font-weight-bold" id="total_tax_preview_invoice"></span>
                                                </div>
                                            </div>
                                        </div>
                                        <hr class="border-danger mt-1 mb-1">
                                        <div class="mt-1">
                                            <div class="row">
                                                <div class="col-6"></div>
                                                <div class="col-4">
                                                    <span class="float-right">Tổng cộng tiền thanh toán:</span>
                                                </div>
                                                <div class="col-2 p-0">
                                                    <span class="font-weight-bold" id="total_after_tax_preview_invoice"></span>
                                                </div>
                                            </div>
                                        </div>
                                        <hr class="border-danger mt-1 mb-1">
                                        <div class="mt-1 ml-3">
                                            <div class="row">
                                                <div class="col-4">
                                                    <span class="float-right">Số tiền viết bằng chữ:</span>
                                                </div>
                                                <div class="col-8 pl-0">
                                                    <span class="font-weight-bold" id="total_in_words_preview_invoice"></span>
                                                </div>
                                            </div>
                                        </div> --}}
                                        {{-- <hr class="border-danger mt-1 mb-1"> --}}
                                        <div class="mt-1 ml-3" style="padding-bottom: 100px; position: relative; top: -22px;">
                                            <div class="row">
                                                <div class="col-3">
                                                    <strong class="ml-4" style="font-size: 15px;">Người nộp tiền</strong>
                                                </div>
                                                <div class="col-4">
                                                    
                                                </div>
                                                <div class="col-4">
                                                    <strong class="float-right" style="font-size: 15px;">Người thu tiền</strong>
                                                </div>
                                            </div>
                                            <div class="row" style="margin-top: -4px;">
                                                <div class="col-3">
                                                    <i class="float-right" style="font-size: 12px; margin-right: 58px;">(Ký, ghi rõ họ tên)</i>
                                                </div>
                                                <div class="col-3"></div>
                                                <div class="col-2"></div>
                                                <div class="col-4">
                                                    <i class="float-right" style="font-size: 12px; margin-right: 42px;">(Ký, đóng dấu, ghi rõ họ tên)</i>
                                                </div>
                                            </div>
                                        </div>
                                        {{-- <p class="text-center m-0" style="font-size: 11px;">
                                            <i>(Cần kiểm tra, đối chiếu khi tạo, lập, nhận hóa đơn)</i>
                                        </p> --}}
                                    </div>
                                </div>
                            {{-- </div> --}}
                        </div>
                        {{-- <div class="modal-footer p-2">
                            <button type="button" class="btn btn-outline-secondary btn-sm" data-dismiss="modal">
                                <i class="fa-solid fa-xmark mr-1"></i>
                                Đóng
                            </button> --}}
                            {{-- <button type="button" class="btn btn-warning btn-sm">
                                <i class="fa-regular fa-copy mr-1"></i>
                                Tạo bản sao
                            </button> --}}
                            {{-- <button type="button" class="btn btn-success btn-sm" id="download_pdf_btn">
                                <i class="fa-regular fa-file-pdf mr-1"></i>
                                Tải tệp PDF
                            </button> --}}
                            {{-- <button type="button" class="btn btn-info btn-sm">
                                <i class="fa-solid fa-print mr-1"></i>
                                In hóa đơn
                            </button> --}}
                        {{-- </div> --}}
                    </div>
                </div>
            </div>

            {{-- Modal Xác nhận xóa BL --}}
            <div class="modal fade" id="modal_destroy" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel">Xác nhận</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            Chắc chắn muốn xóa Biên lai này?
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-outline-secondary btn-sm" data-dismiss="modal">Đóng</button>
                            <button type="button" class="btn btn-danger btn-sm" id="destroy_invoice_btn" style="margin-left: 0.25rem !important;">Xác nhận xóa</button>
                        </div>
                    </div>
                </div>
            </div>

            {{-- Modal Xác nhận xóa hàng loạt BL --}}
            <div class="modal fade" id="modal_destroy_many" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel">Xác nhận</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            Chắc chắn muốn xóa những Biên lai này?
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-outline-secondary btn-sm" data-dismiss="modal">Đóng</button>
                            <button type="button" class="btn btn-danger btn-sm" id="destroy_many_invoice_btn" style="margin-left: 0.25rem !important;">Xác nhận xóa</button>
                        </div>
                    </div>
                </div>
            </div>

            {{-- Modal Tạo BL bằng file Excel --}}
            <div class="modal fade" id="import_excel_modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel">Tạo Biên lai bằng file Excel</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <input type="file" name="" id="file" class="form-control form-control-sm">
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-outline-secondary btn-sm" data-dismiss="modal">Đóng</button>
                            <button type="button" class="btn btn-success btn-sm" id="import_excel_btn" style="margin-left: 0.25rem !important;">Hoàn tất</button>
                        </div>
                    </div>
                </div>
            </div>

            {{-- Modal Xác nhận xóa BL chưa ký --}}
            <div class="modal fade" id="modal_delete_unsigned_invoices" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel">Xác nhận</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            Chắc chắn muốn xóa những Biên lai chưa ký?
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-outline-secondary btn-sm" data-dismiss="modal">Đóng</button>
                            <button type="button" class="btn btn-danger btn-sm" id="destroy_unsigned_invoices_btn" style="margin-left: 0.25rem !important;">Xác nhận xóa</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
@endsection

@section('script')
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="{{ asset('js/numberToWords.js') }}"></script>
<script>
    $(document).ready(function() {
        $(document).on('change', '#apartment', function() {
            $('#customer_name').val('');
            $('#customer_phone_number').val('');
            let apartmentId = $(this).val();
            let blockValue = $('#block').val();
            $.ajax({
                type: "GET",
                url: "{{ route('get.block.from.apartment.invoice') }}",
                data: {
                    apartmentId: apartmentId,
                },
                success: function (res) {
                    if(res.status == 200) {
                        $('#block').html('<option value="0">--- Chọn nhà ---</option>');
                        $('#floor').html('<option value="0">--- Chọn tầng ---</option>');
                        $('#room').html('<option value="0">--- Chọn căn hộ ---</option>');
                        $.each(res.blocks, function(key, value) {
                            $('#block').append('\
                                <option value="'+ value.id +'">'+ value.name +'</option>\
                            ');
                        });
                    }
                }
            });
        });
        
        $(document).on('change', '#block', function() {
            $('#customer_name').val('');
            $('#customer_phone_number').val('');
            let blockId = $(this).val();
            $.ajax({
                type: "GET",
                url: "{{ route('get.floor.from.block.invoice') }}",
                data: {
                    blockId: blockId,
                },
                success: function (res) {
                    if(res.status == 200) {
                        $('#floor').html('<option value="0">--- Chọn tầng ---</option>');
                        $('#room').html('<option value="0">--- Chọn căn hộ ---</option>');
                        $.each(res.floors, function(key, value) {
                            $('#floor').append('\
                                <option value="'+ value.id +'">'+ value.name +'</option>\
                            ');
                        });
                    }
                }
            });
        });

        $(document).on('change', '#floor', function() {
            $('#customer_name').val('');
            $('#customer_phone_number').val('');
            let floorId = $(this).val();
            $.ajax({
                type: "GET",
                url: "{{ route('get.room.from.floor.invoice') }}",
                data: {
                    floorId: floorId,
                },
                success: function (res) {
                    if(res.status == 200) {
                        $('#room').html('<option value="0">--- Chọn căn hộ ---</option>');
                        $.each(res.rooms, function(key, value) {
                        $('#room').append('\
                            <option value="'+ value.id +'">'+ value.name +'</option>\
                        ');
                    });
                    }
                }
            });
        });

        $(document).on('change', '#room', function() {
            let roomId = $(this).val();
            if(roomId == 0) {
                $('#customer_name').val('');
                $('#customer_phone_number').val('');
                return;
            }
            $.ajax({
                type: "GET",
                url: "{{ route('get.household.from.room.invoice') }}",
                data: {
                    roomId: roomId,
                },
                success: function (res) {
                    if(res.status == 200){
                        $('#customer_name').val(res.household[0].fullname);
                        $('#customer_phone_number').val(res.household[0].phone_number);
                    }
                    if(res.status == 400) {
                        alert(res.message);
                        $('#customer_name').val('');
                        $('#customer_phone_number').val('');
                    }
                }
            });
        });

        function capitalizeFirstLetter(string) {
            return string.charAt(0).toUpperCase() + string.slice(1);
        }

        $(document).on('click', '#show_invoice_btn', function (e) {
            e.preventDefault();
            $('#modal_preview').modal('show');
            let invoiceId = $(this).val();
            let url = "{{ route('preview.invoice', ':id') }}";
            url = url.replace(':id', invoiceId);
            $.ajax({
                type: "GET",
                url: url,
                success: function (res) {
                    if(res.status == 200) {
                        let dateCreated = new Date(res.invoice.date_created);
                        let date = dateCreated.getDate();
                        let month = parseFloat(dateCreated.getMonth()) + 1;
                        let year = dateCreated.getFullYear();

                        $('#invoice_id_preview_invoice').val(invoiceId);
                        $('#form_no_preview_invoice').text(res.invoice.form_no);
                        $('#serial_no_preview_invoice').text(res.invoice.serial_no);
                        $('#invoice_no_preview_invoice').text(res.invoice.invoice_no);
                        $('#date_preview_invoice').text(date);
                        $('#month_preview_invoice').text(month);
                        $('#year_preview_invoice').text(year);
                        $('#customer_name_preview_invoice').text(res.customerName);
                        $('#room_preview_invoice').text(res.room);
                        $('#floor_preview_invoice').text(res.floor);
                        $('#block_preview_invoice').text(res.block);
                        $('#apartment_preview_invoice').text(res.apartment);
                        $('#fee_name_preview_invoice').text(res.invoice.fee_name);
                        $('#fee_amount_preview_invoice').text(new Intl.NumberFormat('vi-VN').format(res.invoice.fee_amount));
                        $('#pay_method_preview_invoice').text(res.invoice.pay_method);

                        $('#total_in_words_preview_invoice').text(capitalizeFirstLetter(convert.toWords(parseFloat(res.invoice.fee_amount))) + ' VND');
                    }
                }
            });
        });

        $(document).on('click', '#delete_invoice_btn', function(e) {
            e.preventDefault();
            $('#modal_destroy').modal('show');
            let invoiceId = $(this).val();
            let url = "{{ route('delete.invoice', ':id') }}";
            url = url.replace(':id', invoiceId);

            $('#destroy_invoice_btn').prop('disabled', false).click(function(e) {
                e.preventDefault();
                $(this).prop('disabled', true);
                $.ajax({
                    type: "DELETE",
                    url: url,
                    data: { 
                        _token: "{{ csrf_token() }}",
                    },
                    success: function (res) {
                        if(res.status == 200) {
                            // $('#r_id_' + invoiceId).remove();
                            $('#modal_destroy').modal('hide');
                            $('#refresh_input_search_btn').click();
                            alert(res.message);
                            $('#destroy_invoice_btn').prop('disabled', false);
                            $('#destroy_invoice_btn').off(0);
                        }
                    }
                });
            });
        });

        $(document).prop('disabled', false).on('click', '#search_invoice_btn', function(e) {
            e.preventDefault();
            $(this).prop('disabled', true);
            let formNo = $('#form_no > option:selected');
            let serialNo = $('#serial_no');
            let invoiceNo = $('#invoice_no');
            let status = $('#status');
            let dateCreated = $('#date_created');
            let creator = $('#creator > option:selected');
            let apartment = $('#apartment');
            let block = $('#block');
            let floor = $('#floor');
            let room = $('#room');
            let customerName = $('#customer_name');
            let customerPhoneNumber = $('#customer_phone_number');

            $.ajax({
                type: "GET",
                url: "{{ route('search.invoice') }}",
                data: {
                    formNo: formNo.text(),
                    serialNo: serialNo.val(),
                    invoiceNo: invoiceNo.val(),
                    status: status.val(),
                    dateCreated: dateCreated.val(),
                    creator: creator.val() > 0 ? creator.text() : '',
                    apartment: apartment.val() > 0 ? apartment.val() : '',
                    block: block.val() > 0 ? block.val() : '',
                    floor: floor.val() > 0 ? floor.val() : '',
                    room: room.val() > 0 ? room.val() : '',
                    customerName: customerName.val(),
                    customerPhoneNumber: customerPhoneNumber.val(),
                },
                success: function (res) {
                    $('#list_invoice_table').html(res);
                    $('#links').addClass('d-none');
                    $('#row').addClass('d-none');
                    $('#search_invoice_btn').prop('disabled', false);
                }
            });
            $(this).off('click');
        });

        $(document).prop('disabled', false).on('click', '#refresh_input_search_btn', function(e) {
            e.preventDefault();
            $(this).prop('disabled', true);
            $('#form_search').find(':input').val('');
            $('#form_search').find('select').val('0');
            $('#form_no').val('1c21tnh');
            $('#row').val('5').change();
            if($('#links').hasClass('d-none')) 
                $('#links').removeClass('d-none');
            if($('#row').hasClass('d-none')) 
                $('#row').removeClass('d-none');
            $(this).prop('disabled', false);
            $(this).off('click');
        });

        $(document).on('click', '.pagination a', function(e) {
            e.preventDefault();
            let page = $(this).attr('href').split('?page=')[1];
            let numRow = $('#row').val();
            $.ajax({
                url: "/admins/invoice/fetch?page=" + page,
                data: {
                    numRow: numRow > 0 ? numRow : 0,
                },
                success: function (res) {
                    $('#list_invoice_table').html(res);
                    $('#row').val(numRow);
                }
            });
        });

        $(document).on('change', '#row', function() {
            let numRow = $(this).val();
            $.ajax({
                url: "{{ route('get.row.invoice') }}",
                data: {
                    numRow: numRow,
                },
                success: function (res) {
                    $('#list_invoice_table').html(res);
                    $('#row').val(numRow);
                }
            });
        });

        $(document).on('change', '#check_all', function() {
            let isChecked = $(this).prop('checked');
            $('.check_box').prop('checked', isChecked);
            countCheckedNumber()
        });

        $(document).on('change', '.check_box', function() {
            let checkBoxItemNumber = $('.check_box').length === $('input:checkbox[name="ids"]:checked').length;
            $('#check_all').prop('checked', checkBoxItemNumber);
            countCheckedNumber()
        });

        function countCheckedNumber() {
            let checkedCount = $('input:checkbox[name="ids"]:checked').length;
            // if(checkedCount > 0)
            //     deleteManyBtn.attr('hidden', false);
            // else
            //     deleteManyBtn.attr('hidden', true);
        }

        $(document).on('click', '#delete_many_btn', function(e) {
            e.preventDefault();
            let allIds = [];
            $('input:checkbox[name="ids"]:checked').each(function() {
                allIds.push($(this).val());
            });
            if(allIds.length == 0) return;
            $('#modal_destroy_many').modal('show');

            $('#destroy_many_invoice_btn').prop('disabled', false).click(function(e) {
                e.preventDefault();
                $(this).prop('disabled', true);
                $.ajax({
                    type: "DELETE",
                    url: "{{ route('delete.many.invoices') }}",
                    data: {
                        allIds: allIds,
                        _token: '{{ csrf_token() }}',
                    },
                    success: function (res) {
                        if(res.status == 200) {
                            $('#modal_destroy_many').modal('hide');
                            $('#refresh_input_search_btn').click();
                            alert(res.message);
                            $('#destroy_many_invoice_btn').prop('disabled', false);
                            $('#destroy_many_invoice_btn').off();
                            // $('#success_message').addClass('alert alert-success');
                            // $('#success_message').text(res.message);
                        }
                    }
                });
            });
        });

        $(document).on('click', '#import_excel_modal_btn', function(e) {
            e.preventDefault();
            $('#import_excel_modal').modal('show');
            
            $('#import_excel_btn').prop('disabled', false).click(function(e) {
                e.preventDefault();
                $(this).prop('disabled', true);
                let file = $('#file')[0].files;
                if(file.length > 0) {
                    let fd = new FormData();
                    fd.append('file', file[0]);
                    fd.append('_token', '{{ csrf_token() }}');
                    $.ajax({
                        type: "POST",
                        url: "{{ route('import.excel.invoice') }}",
                        data: fd,
                        contentType: false,
                        processData: false,
                        dataType: "json",
                        success: function (res) {
                            if(res.status == 200) {
                                $('#import_excel_modal').modal('hide');
                                $('#refresh_input_search_btn').click();
                                alert(res.message);
                                // $('#success_message').addClass('alert alert-success');
                                // $('#success_message').text(res.message);
                                $('#import_excel_btn').prop('disabled', false);
                                $('#import_excel_btn').off(e);
                                $('#file').val('');
                            }
                            if(res.status == 400) {
                                $('#import_excel_modal').modal('hide');
                                alert(res.message);
                                // $('#success_message').addClass('alert alert-danger');
                                // $('#success_message').text(res.message);
                                $('#import_excel_btn').prop('disabled', false);
                                $('#import_excel_btn').off(e);
                                $('#file').val('');
                            }
                        },
                        error: function(xhr, status, error) {
                            // var err = eval("(" + xhr.responseText + ")");
                            $('#import_excel_modal').modal('hide');
                            alert('Biên lai đã tồn tại');
                            $('#import_excel_btn').prop('disabled', false);
                            $('#import_excel_btn').off(e);
                            $('#file').val('');
                        }
                    });
                } else {
                    alert('Vui lòng chọn file Excel');
                    $('#import_excel_btn').prop('disabled', false);
                    $('#import_excel_btn').off(e);
                    $('#file').val('');
                }
            });
        });

        $(document).on('click', '#delete_unsigned_invoices', function(e) {
            e.preventDefault();
            $('#modal_delete_unsigned_invoices').modal('show');
            
            $('#destroy_unsigned_invoices_btn').prop('disabled', false).off('click').click(function(e) {
                e.preventDefault();
                $(this).prop('disabled', true);
                $.ajax({
                    type: "DELETE",
                    url: "{{ route('delete.unsigned.invoices') }}",
                    data: {
                        _token: '{{ csrf_token() }}',
                    },
                    success: function (res) {
                        $('#modal_delete_unsigned_invoices').modal('hide');
                        $('#refresh_input_search_btn').click();
                        alert(res.message);
                        $('#destroy_unsigned_invoices_btn').prop('disabled', false);
                    }
                });
            });
        });

        $(document).prop('disabled', false).off('click', '#btn_publish').on('click', '#btn_publish', function(e) {
            // return;
            e.preventDefault();
            $(this).prop('disabled', true);
            $.ajax({
                type: "POST",
                url: "{{ route('publish.invoice') }}",
                data: {
                    _token: '{{ csrf_token() }}',
                },
                success: function (res) {
                    alert(res.message.adjustInvResult);
                }
            });
            $(this).prop('disabled', false);
        });
    });
</script>
@endsection
