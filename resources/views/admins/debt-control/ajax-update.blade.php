<form action="{{route('post.debt.arr.id.update')}}" method="POST" accept-charset="utf-8">
    @csrf
    @method('POST')
<div class="container mt-4" style="padding-top: 30px;">    
	<h4>Chỉnh sửa</h4>              
    <div class="overflow-auto">

    	<table class="table mb-1" border="1">
            <thead class="thead-light">
                <tr>
                    <th scope="col" rowspan="3" style="min-width: 50px !important;">STT</th>
                    <th scope="col" rowspan="3" style="min-width: 50px !important;">Đối tượng</th>
                    <th scope="col" rowspan="3">Chủ hộ</th>
                    <th scope="col" rowspan="3" style="min-width: 80px !important;">Căn hộ</th>
                    <th scope="col" rowspan="3" style="min-width: 80px !important;">Ngày ký HĐ</th>
                    <th scope="col" rowspan="3" style="min-width: 50px !important;">Trạng thái</th>
                    <th scope="col" rowspan="3">Đơn giá</th>
                    <th scope="col" rowspan="3" style="min-width: 50px !important;">Miễn giảm <br> (nếu có)</th>
                    <th scope="col" rowspan="3">ĐG sau <br> MG</th>
                    <th scope="col" colspan="7" class="text-center text-uppercase">Số dư đầu kỳ</th>
                    <th scope="col" colspan="6" class="text-center text-uppercase">Số phải thu phát sinh</th>
                    <th scope="col" colspan="7" class="text-center text-uppercase">Số đã thu</th>
                    <th scope="col" colspan="3" class="text-center text-uppercase">Điều chỉnh số đã thu</th>
                    <th scope="col" colspan="7" class="text-center text-uppercase">Số dư cuối kì</th>
                    <th scope="col" rowspan="3" class="text-center text-uppercase">Ghi chú</th>
                </tr>
                <tr>
                	<!-- Số dư đầu kì -->
                    <th scope="col" rowspan="2" style="min-width: 50px !important;">Số tháng</th>
                    <th scope="col" rowspan="2" style="min-width: 80px !important;">Từ tháng</th>
                    <th scope="col" rowspan="2" style="min-width: 80px !important;">Đến tháng</th>
                    <th scope="col" rowspan="2">Số còn <br> phải thu</th>
                    <th scope="col" colspan="2" class="text-center">Số thu trước</th>
                    <th scope="col" rowspan="2">Thu thừa</th>
                    <!-- end số dư đầu kì -->

                    <!-- Số phải thu phát sinh -->
                    <th scope="col" rowspan="2">Số phải thu</th>

                    <th scope="col" rowspan="2">Số phải thu hộ giải tỏa chưa nộp tiền</th>

                    <th scope="col" rowspan="2">Truy thu</th>

                    <th scope="col" rowspan="2">Ghi chú <br> (Truy thu)</th>

                    <th scope="col" rowspan="2">Giảm trừ</th>

                    <th scope="col" rowspan="2">Ghi chú <br> (Giảm trừ)</th>
                    <!-- end số phải thu phát sinh -->
                    <!-- Số đã thu -->
                    <th scope="col" rowspan="2" style="min-width: 50px !important;">Số tháng</th>
                    <th scope="col" rowspan="2" style="min-width: 80px !important;">Từ tháng</th>
                    <th scope="col" rowspan="2" style="min-width: 80px !important;">Đến tháng</th>
                    <th scope="col" rowspan="2">Năm nay</th>
                    <th scope="col" rowspan="2">Năm sau</th>
                    <th scope="col" rowspan="2">Thu thừa</th>
                    <th scope="col" rowspan="2">Tổng cộng</th>
                    <!-- end số đã thu -->
                    <!-- điều chỉnh số đã thu -->
                    <th scope="col" rowspan="2">Năm nay</th>
                    <th scope="col" rowspan="2">Năm sau</th>
                    <th scope="col" rowspan="2">Thu thừa</th>
                    <!-- end điều chỉnh số đã thu -->

                    <!-- Số dư cuối kì -->
                    <th scope="col" rowspan="2" style="min-width: 50px !important;">Số tháng</th>
                    <th scope="col" rowspan="2" style="min-width: 80px !important;">Từ tháng</th>
                    <th scope="col" rowspan="2" style="min-width: 80px !important;">Đến tháng</th>
                    <th scope="col" rowspan="2">Số còn <br> phải thu</th>
                    <th scope="col" colspan="2" class="text-center">Số thu trước</th>
                    <th scope="col" rowspan="2">Thu thừa</th>
                    <!-- end số dư cuối kì -->
                </tr>
                <tr>
                	<!-- số dư đầu kì -->
                    <th scope="col">Năm nay</th>
                    <th scope="col">Năm sau</th>
                    <!-- end số dư đầu kì -->
                    <!-- sô dư cuối kì -->
                    <th scope="col">Năm nay</th>
                    <th scope="col">Năm sau</th>
                    <!-- end số dư cuối kì -->
                </tr>
            </thead>
            <tbody>
            	@if ($debt_control_generals && count($debt_control_generals) > 0)
            	@foreach ($debt_control_generals as $key => $debt_control_general)
            	@php $debt_control_details = $debt_control_general->debtControlDetail; @endphp
            	@foreach ($debt_control_details as $key1 => $debt_control_detail)
            	<tr style="background-color: {{($key % 2 != 0) ? 'yellow' : ''}}; ">
                    <input type="number" name="debt_control_detail_id[]" value="{{$debt_control_detail->id}}" hidden>
            		@if ($key1 == 0)
                    <input type="number" name="debt_control_general_id" value="{{$debt_control_general->id}}" hidden>
            		<td scope="col" rowspan="{{$debt_control_details->count()}}">{{$key+1}}</td>
            		<td scope="col" rowspan="{{$debt_control_details->count()}}">{{$debt_control_general->household_room->residentObject->title}}</td>
            		<td scope="col" rowspan="{{$debt_control_details->count()}}">{{$debt_control_general->household_room->household->fullname}}</td>
            		<td scope="col" rowspan="{{$debt_control_details->count()}}">{{$debt_control_general->household_room->room->name}}</td>
            		<td scope="col" rowspan="{{$debt_control_details->count()}}">{{$debt_control_general->household_room->contract_signing_date}}</td>
            		<td scope="col" rowspan="{{$debt_control_details->count()}}"></td>
            		@endif
            		<td>{{$debt_control_detail->price}}</td>
            		<td>{{$debt_control_detail->exemption}}</td>
            		<td>{{$debt_control_detail->price_after_policy}}</td>
            		<td>{{$debt_control_detail->number_month_first_period}}</td>
            		<td>{{$debt_control_detail->from_month_first_period}}</td>
            		<td>{{$debt_control_detail->to_month_first_period}}</td>
            		<td>{{$debt_control_detail->outstanding_amount_first_period}}</td>
            		<td>{{$debt_control_detail->revenue_before_this_year_first_period}}</td>
            		<td>{{$debt_control_detail->revenue_before_next_year_first_period}}</td>
            		<td>{{$debt_control_detail->excess_collection_first_period}}</td>
            		@if ($key1 == 0)
            		<td rowspan="{{$debt_control_details->count()}}"><input type="number" name="receivable" value="{{$debt_control_general->receivable}}" placeholder=""></td>
            		<td rowspan="{{$debt_control_details->count()}}"><input type="number" name="unpaid_receivable_relieve" value="{{$debt_control_general->unpaid_receivable_relieve}}" placeholder=""></td>
            		<td rowspan="{{$debt_control_details->count()}}">
                        <input type="number" class="" name="arrears" value="" placeholder="Truy thu">
                        <select class="c-select mt-2" name="add_arrears">
                            <option value="1">Thêm dòng</option>
                            <option value="2">Không thêm dòng</option>
                        </select>

                    </td>
            		<td rowspan="{{$debt_control_details->count()}}"><textarea placeholder="Ghi chú truy thu" name="note_arrears">{{$debt_control_general->note_arrears}}</textarea></td>
            		<td rowspan="{{$debt_control_details->count()}}"><input type="number" name="reduce" value="" placeholder="Giảm trừ"></td>
            		<td rowspan="{{$debt_control_details->count()}}"><textarea placeholder="Ghi chú giảm trừ" name="note_reduce">{{$debt_control_general->note_reduce}}</textarea></td>
            		@endif
            		<td><input type="number" name="number_month_amount_received_detail[]" value="{{$debt_control_detail->number_month_amount_received_detail}}" placeholder="Số tháng"></td>
            		<td><input type="text" name="from_month_amount_received_detail[]" value="{{$debt_control_detail->from_month_amount_received_detail}}" placeholder="Từ tháng"></td>
            		<td><input type="text" name="to_month_amount_received_detail[]" value="{{$debt_control_detail->to_month_amount_received_detail}}" placeholder="Đến tháng"></td>
            		<td><input type="number" name="this_year_amount_received_detail[]" value="{{$debt_control_detail->this_year_amount_received_detail}}" placeholder="Năm nay"></td>
            		<td><input type="number" name="next_year_amount_received_detail[]" value="{{$debt_control_detail->next_year_amount_received_detail}}" placeholder="Năm sau"></td>
            		<td><input type="number" name="excess_collection_amount_received_detail[]" value="{{$debt_control_detail->excess_collection_amount_received_detail}}" placeholder="Thu thừa"></td>
            		<td rowspan="">{{$debt_control_detail->sum_price_amount_received_detail}}</td>
            		<td><input type="number" name="adjust_this_year[]" value="{{$debt_control_detail->adjust_this_year}}" placeholder="Năm nay"></td>
            		<td><input type="number" name="adjust_next_year[]" value="{{$debt_control_detail->adjust_next_year}}" placeholder="Năm sau"></td>
            		<td><input type="number" name="adjust_excess_collection[]" value="{{$debt_control_detail->adjust_excess_collection }}" placeholder="Thu thừa"></td>
            		<td><input type="number" name="number_month_last_period[]" value="{{$debt_control_detail->number_month_last_period }}" placeholder="Số tháng"></td>
            		<td><input type="text" name="from_month_last_period[]" value="{{$debt_control_detail->from_month_last_period }}" placeholder="Từ tháng"></td>
            		<td><input type="text" name="to_month_last_period[]" value="{{$debt_control_detail->to_month_last_period }}" placeholder="Đến tháng"></td>
            		<td><input type="number" name="outstanding_amount_last_period[]" value="{{$debt_control_detail->outstanding_amount_last_period }}" placeholder=""></td>
            		<td><input type="number" name="revenue_before_this_year_last_period[]" value="{{$debt_control_detail->revenue_before_this_year_last_period}}" placeholder="Năm nay"></td>
            		<td><input type="number" name="revenue_before_next_year_last_period[]" value="{{$debt_control_detail->revenue_before_next_year_last_period }}" placeholder="Năm sau"></td>
            		<td><input type="number" name="excess_collection_last_period[]" value="{{$debt_control_detail->excess_collection_last_period}}" placeholder="Thu thừa"></td>
            		@if ($key1 == 0)
            		<td scope="col" rowspan="{{$debt_control_details->count()}}"><textarea name="note_debt_control_general">{{$debt_control_general->note_debt_control_general}}</textarea></td>
            		@endif
            	</tr>
            	@endforeach
            	@endforeach
            	@else
            	<tr>
            		<td colspan="41" rowspan="" headers="">Không có dữ liệu</td>
            	</tr>
            	@endif
            </tbody>            
        </table>
    </div>
</div>
<div class="row text-right mt-3 mr-2 mb-2">
	<div class="col-lg-12">
			<a href="#" class="btn btn-outline-info" data-dismiss="modal">Đóng</a>
			<button class="btn btn-info">Lưu lại</button>
	</div>
</div>
</form>