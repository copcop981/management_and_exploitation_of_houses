<form action="{{route('post.debt.id.tach')}}" method="POST" accept-charset="utf-8">
    @csrf
    @method('POST')
<div class="container mt-4" style="padding-top: 30px;">    
	<h4>Tách nợ</h4>
    <hr style="width: 80px; margin: auto;">
    @if ($debt_control_general)
    <p>Thông tin hộ dân: {{$debt_control_general->household_room->household->fullname}} - {{$debt_control_general->household_room->room->name}}  . Loại: Biên lai</p>
    <p>Tổng tiền thu: {{$debt_control_general->amountReceived['sum_price_amount_received']}}</p>
    <p>Tháng: {{$debt_control_general->month->title}}/{{$debt_control_general->year->title}}</p>
    @endif
    <div class="overflow-auto">

    	<table class="table mb-1" border="1">
            <thead class="thead-light">
                <tr>
                    <th scope="col" rowspan="3">Đơn giá</th>
                    <th scope="col" rowspan="3" style="min-width: 50px !important;">Miễn giảm <br> (nếu có)</th>
                    <th scope="col" rowspan="3">ĐG sau <br> MG</th>
                    <th scope="col" colspan="7" class="text-center text-uppercase">Số dư đầu kỳ</th>
                    <th scope="col" rowspan="3">Phải thu <br> (tháng này)</th>
                    <th scope="col" rowspan="3">Đã thu <br> (tháng này)</th>
                    <th scope="col" colspan="7" class="text-center text-uppercase">Số đã thu</th>
                </tr>
                <tr>
                	<!-- Số dư đầu kì -->
                    <th scope="col" rowspan="2" style="min-width: 50px !important;">Số tháng</th>
                    <th scope="col" rowspan="2" style="min-width: 80px !important;">Từ tháng</th>
                    <th scope="col" rowspan="2" style="min-width: 80px !important;">Đến tháng</th>
                    <th scope="col" rowspan="2">Số còn <br> phải thu</th>
                    <th scope="col" colspan="2" class="text-center">Số thu trước</th>
                    <th scope="col" rowspan="2">Thu thừa</th>
                    <!-- end số dư đầu kì -->

                    <!-- Số đã thu -->
                    <th scope="col" rowspan="2" style="min-width: 50px !important;">Số tháng</th>
                    <th scope="col" rowspan="2" style="min-width: 80px !important;">Từ tháng</th>
                    <th scope="col" rowspan="2" style="min-width: 80px !important;">Đến tháng</th>
                    <th scope="col" rowspan="2">Năm nay</th>
                    <th scope="col" rowspan="2">Năm sau</th>
                    <th scope="col" rowspan="2">Thu thừa</th>
                    <th scope="col" rowspan="2">Tổng cộng</th>
                    <!-- end số đã thu -->
                </tr>
                <tr>
                	<!-- số dư đầu kì -->
                    <th scope="col">Năm nay</th>
                    <th scope="col">Năm sau</th>
                    <!-- end số dư đầu kì -->
                </tr>
            </thead>
            <tbody>
            	@if ($debt_control_general)
            	@php $debt_control_details = $debt_control_general->debtControlDetail; @endphp
            	@foreach ($debt_control_details as $key1 => $debt_control_detail)
            	<tr style="background-color: {{($key1 % 2 != 0) ? 'yellow' : ''}}; ">
                    <input type="number" name="debt_control_detail_id[]" value="{{$debt_control_detail->id}}" hidden>
            		<td>{{$debt_control_detail->price}}</td>
            		<td>{{$debt_control_detail->exemption}}</td>
            		<td>{{$debt_control_detail->price_after_policy}}</td>
            		<td>{{$debt_control_detail->number_month_first_period}}</td>
            		<td>{{$debt_control_detail->from_month_first_period}}</td>
            		<td>{{$debt_control_detail->to_month_first_period}}</td>
            		<td>{{$debt_control_detail->outstanding_amount_first_period}}</td>
            		<td>{{$debt_control_detail->revenue_before_this_year_first_period}}</td>
            		<td>{{$debt_control_detail->revenue_before_next_year_first_period}}</td>
            		<td>{{$debt_control_detail->excess_collection_first_period}}</td>
                    @if ($key1 == 0)
                    <td scope="col" rowspan="{{$debt_control_details->count()}}">{{$debt_control_general->receivable}}</td>
                    <td scope="col" rowspan="{{$debt_control_details->count()}}">
                        <input type="number" name="receivable_amount" class="form-control">
                    </td>
                    @endif
                    @php

                    @endphp
            		<td><input type="number" name="number_month_amount_received_detail[]" value="{{$debt_control_detail->amount_received['number_month_amount_received']}}" placeholder="Số tháng"></td>
            		<td><input type="text" name="from_month_amount_received_detail[]" value="{{$debt_control_detail->amount_received['from_month_amount_received']}}" placeholder="Từ tháng"></td>
            		<td><input type="text" name="to_month_amount_received_detail[]" value="{{$debt_control_detail->amount_received['to_month_amount_received']}}" placeholder="Đến tháng"></td>
            		<td><input type="number" name="this_year_amount_received_detail[]" value="{{$debt_control_detail->amount_received['this_year_amount_received']}}" placeholder="Năm nay"></td>
            		<td><input type="number" name="next_year_amount_received_detail[]" value="{{$debt_control_detail->amount_received['next_year_amount_received']}}" placeholder="Năm sau"></td>
            		<td><input type="number" name="excess_collection_amount_received_detail[]" value="{{$debt_control_detail->amount_received['excess_collection_amount_received']}}" placeholder="Thu thừa"></td>
            		<td rowspan="">{{$debt_control_detail->amount_received['sum_price_amount_received']}}</td>
            	</tr>
            	@endforeach
            	@else
            	<tr>
            		<td colspan="41" rowspan="" headers="">Không có dữ liệu</td>
            	</tr>
            	@endif
            </tbody>            
        </table>
    </div>
</div>

<div class="row text-right mt-3 mr-2 mb-2">
	<div class="col-lg-12">
			<a href="#" class="btn btn-outline-info" data-dismiss="modal">Đóng</a>
			<button class="btn btn-info">Hoàn tất</button>
	</div>
</div>
</form>