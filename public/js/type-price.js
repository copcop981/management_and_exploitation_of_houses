// tp = Type Price

function tpValidate(name, btn) {
    let validateName = validateField(name, btn, 'input', 'Vui lòng nhập Loại tiền');
    if(!validateName) return false;
    return true;
}

$(document).off('click', '#tp_btn_create').on('click', '#tp_btn_create', function(e) {
    e.preventDefault();
    $('#tp_modal_create').modal('show');

    $(document).prop('disabled', false).off('click', '#tp_btn_store').on('click', '#tp_btn_store', function(e) {
        e.preventDefault();
        $(this).prop('disabled', true);
        if(!tpValidate('#tp_name_create', $(this))) return;
        let name = $('#tp_name_create');
        let typeReceipt = $('#tp_type_receipt_create');
        $.ajax({
            type: "POST",
            url: route.store,
            data: {
                name: name.val(),
                typeReceiptId: typeReceipt.val(),
                paradigmId: paradigmId,
                _token: token,
            },
            success: function (res) {
                if(res.status === 0) {
                    alert(res.message);
                    $('#tp_btn_store').prop('disabled', false);
                    $('#tp_modal_create').modal('hide');
                    $('#row').val('5').trigger('change');
                }
                if(res.status === 1 || res.status === 2) {
                    alert(res.message);
                    $('#tp_btn_store').prop('disabled', false);
                    name.trigger('focus');
                }
            }
        });
    });

    $(document).off('click', '#tp_btn_refresh_store').on('click', '#tp_btn_refresh_store', function(e) {
        e.preventDefault();
        $('#tp_form_create').find(':input:not("#tp_type_receipt_create")').val('');
        removeValidateDanger('#tp_form_create');
    });
    
    $(document).off('hidden.bs.modal', '#tp_modal_create').on('hidden.bs.modal', '#tp_modal_create', function() {
        $('#tp_btn_refresh_store').trigger('click');
    });
});
    
$(document).off('click', '#tp_btn_edit').on('click', '#tp_btn_edit', function(e) {
    e.preventDefault();
    let id = $(this).val();
    let name = $('#tp_name_edit');
    let typeReceipt = $('#tp_type_receipt_edit');
    $('#tp_modal_edit').modal('show');

    $(document).off('shown.bs.modal', '#tp_modal_edit').on('shown.bs.modal', '#tp_modal_edit', function() {
        $.ajax({
            type: "GET",
            url: route.edit.replace(':id', id),
            success: function (res) {
                if(res.typePrice !== null) {
                    name.val(res.typePrice.type);
                    typeReceipt.html('');
                    $.each(res.typeReceipts, function(key, value) {
                        typeReceipt.append('<option value="'+ value.id +'">'+ value.type +'</option>');
                        if(value.id == res.typePrice.type_receipt_id) {
                            $('#tp_type_receipt_edit > option').prop('selected', true);
                        }
                    });
                }
            }
        });
    });

    $(document).prop('disabled', false).off('click', '#tp_btn_update').on('click', '#tp_btn_update', function(e) {
        e.preventDefault();
        $(this).prop('disabled', true);
        if(!tpValidate('#tp_name_edit', $(this))) return;
        $.ajax({
            type: "PATCH",
            url: route.update.replace(':id', id),
            data: {
                name: name.val(),
                typeReceiptId: typeReceipt.val(),
                paradigmId: paradigmId,
                _token: token,
            },
            success: function (res) {
                if(res.status === 0) {
                    alert(res.message);
                    $('#tp_btn_update').prop('disabled', false);
                    $('#tp_modal_edit').modal('hide');
                    $('#row').val('5').trigger('change');
                }
                if(res.status === 1 || res.status === 2) {
                    alert(res.message);
                    $('#tp_btn_update').prop('disabled', false);
                    name.trigger('focus');
                }
            }
        });
    });

    $(document).off('click', '#tp_btn_refresh_update').on('click', '#tp_btn_refresh_update', function(e) {
        e.preventDefault();
        $('#tp_modal_edit').trigger('shown.bs.modal');
        removeValidateDanger('#tp_form_edit');
    });

    $(document).off('hidden.bs.modal', '#tp_modal_edit').on('hidden.bs.modal', '#tp_modal_edit', function() {
        $('#tp_btn_refresh_update').trigger('click');
    });
});

$(document).off('click', '#tp_btn_delete').on('click', '#tp_btn_delete', function(e) {
    e.preventDefault();
    let id = $(this).val();
    $('#tp_modal_delete').modal('show');

    $(document).prop('disabled', false).off('click', '#tp_btn_destroy').on('click', '#tp_btn_destroy', function(e) {
        e.preventDefault();
        $(this).prop('disabled', true);
        $.ajax({
            type: "DELETE",
            url: route.destroy.replace(':id', id),
            data: { _token: token, },
            success: function (res) {
                if(res.status === 0) {
                    alert(res.message);
                    $('#tp_btn_destroy').prop('disabled', false);
                    $('#tp_modal_delete').modal('hide');
                    $('#row').val('5').trigger('change');
                }
                if(res.status === 1) {
                    alert(res.message);
                    $('#tp_btn_destroy').prop('disabled', false);
                }
            }
        });
    });
});

$(document).off('click', '.pagination a').on('click', '.pagination a', function(e) {
    e.preventDefault();
    let page = $(this).attr('href').split('?page=')[1];
    let numRow = $('#row').val();
    $.ajax({
        url: "/admins/paradigms-apartments-type-price/pagination/fetch?page=" + page,
        data: { 
            paradigmId: paradigmId,
            numRow: numRow > 0 ? numRow : 0,
        },
        success: function (res) {
            $('#list_type_price_table').html(res);
            $('#row').val(numRow);
        }
    });
});

$(document).off('change', '#row').on('change', '#row', function() {
    let numRow = $(this).val();
    $.ajax({
        url: route.getRow,
        data: {
            paradigmId: paradigmId,
            numRow: numRow,
        },
        success: function (res) {
            $('#list_type_price_table').html(res);
            $('#row').val(numRow);
        }
    });
});
