<?php

namespace App\Repositories;

use App\Models\TypePrice;
use Illuminate\Http\Request;
use App\Http\Requests\RequestResetPass;

class TypePriceRepository extends AbstractRepository
{
    public function getModel()
    {
        return TypePrice::class;
    }

    public function getListByParadigmID($paradigm_id) {

        return $this->model->where('paradigm_id', $paradigm_id)->get();

    }

    public function getListPaginateById($id) {
        $list = $this->model->where('paradigm_id', $id)->orderBy('id', 'DESC');
        return $list;
    }

    public function createe($params) {
        $data = array();
        $isExists = $this->model->where('type' , $params['type'])->where('paradigm_id', $params['paradigm_id'])->exists();
        if($isExists) {
            $data['status'] = 2;
            $data['message'] = 'Tên loại tiền này đã tồn tại';
        } else {
            $query = $this->create($params);
            if($query !== null) {
                $data['status'] = 0;
                $data['message'] = 'Thêm Loại tiền thành công';
            } else {
                $data['status'] = 1;
                $data['message'] = 'Thêm thất bại';
            }
        }
        return $data;
    }

    public function updatee($id, $params) {
        $data = array();
        $exceptThisType = $this->model->where('id', $id)->value('type');
        $isExists = $this->model->where('type' , $params['type'])->where('paradigm_id', $params['paradigm_id'])
                                ->whereNotIn('type', [$exceptThisType])->exists();
        if($isExists) {
            $data['status'] = 2;
            $data['message'] = 'Tên loại tiền này đã tồn tại';
        } else {
            $query = $this->update($id, $params);
            if($query > 0) {
                $data['status'] = 0;
                $data['message'] = 'Cập nhật Loại tiền thành công';
            } else {
                $data['status'] = 1;
                $data['message'] = 'Cập nhật thất bại';
            }
        }
        return $data;
    }

    public function deletee($id) {
        $data = array();
        $query = $this->delete($id);
        if($query > 0) {
            $data['status'] = 0;
            $data['message'] = 'Xóa Loại tiền thành công';
        } else {
            $data['status'] = 1;
            $data['message'] = 'Xóa thất bại';
        }
        return $data;
    }
}
